{
  "paragraphs": [
    {
      "text": "%md\n####Notebook \"PROMO_FILTERING_FOR_RECALCULATION\". \n####*Get promoes filtering by changes incidents*.\n###### *Developer: [LLC Smart-Com](http://smartcom.software/), andrey.philushkin@effem.com*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T12:59:47+0000",
      "progress": 0,
      "config": {
        "tableHide": true,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true,
          "completionSupport": false
        },
        "editorMode": "ace/mode/markdown",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<p>####Notebook &ldquo;PROMO_FILTERING_FOR_RECALCULATION&rdquo;.<br />\n####<em>Get promoes filtering by changes incidents</em>.</p>\n<h6><em>Developer: <a href=\"http://smartcom.software/\">LLC Smart-Com</a>, <a href=\"mailto:andrey.philushkin@effem.com\">andrey.philushkin@effem.com</a></em></h6>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1276882951",
      "id": "20220810-113330_1807397363",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "FINISHED",
      "focus": true,
      "$$hashKey": "object:895",
      "dateFinished": "2023-07-13T12:59:49+0000",
      "dateStarted": "2023-07-13T12:59:47+0000"
    },
    {
      "text": "%pyspark\ndef is_notebook() -> bool:\n    try:\n        shell = get_ipython().__class__.__name__\n        if shell == 'ZMQInteractiveShell':\n            return True   # Jupyter notebook or qtconsole\n        elif shell == 'TerminalInteractiveShell':\n            return False  # Terminal running IPython\n        else:\n            return False  # Other type (?)\n    except NameError:\n        return False      # Probably standard Python interpreter",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T12:59:49+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/python",
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_454669795",
      "id": "paragraph_1660132597099_1824680518",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "FINISHED",
      "$$hashKey": "object:896",
      "dateFinished": "2023-07-13T13:00:26+0000",
      "dateStarted": "2023-07-13T12:59:49+0000"
    },
    {
      "text": "%pyspark\nfrom pyspark.sql import SQLContext, DataFrame, Row, Window\nfrom pyspark.sql import SparkSession\nfrom pyspark.context import SparkContext\nfrom pyspark.sql.types import *\nfrom pyspark.sql.functions import *\nimport pyspark.sql.functions as F\nimport pandas as pd\nimport datetime, time\nimport os\nimport json\nimport subprocess\n",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T13:00:26+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_974215789",
      "id": "20220810-113330_500009667",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "FINISHED",
      "$$hashKey": "object:897",
      "dateFinished": "2023-07-13T13:00:27+0000",
      "dateStarted": "2023-07-13T13:00:26+0000"
    },
    {
      "text": "%pyspark\ndatesDimSchema = StructType([\n  StructField(\"OriginalDate\", DateType(), False),\n  StructField(\"MarsYear\", IntegerType(), False),\n  StructField(\"MarsPeriod\", IntegerType(), False),\n  StructField(\"MarsWeek\",  IntegerType(), False),\n  StructField(\"MarsDay\", IntegerType(),  False),\n  StructField(\"MarsPeriodName\", StringType(), False),\n  StructField(\"MarsPeriodFullName\",  StringType(), False),\n  StructField(\"MarsWeekName\", StringType(),  False),\n  StructField(\"MarsWeekFullName\", StringType(), False),\n  StructField(\"MarsDayName\", StringType(), False),\n  StructField(\"MarsDayFullName\",  StringType(), False),\n  StructField(\"CalendarYear\", IntegerType(),  False),\n  StructField(\"CalendarMonth\", IntegerType(), False),\n  StructField(\"CalendarDay\", IntegerType(), False),\n  StructField(\"CalendarDayOfYear\",  IntegerType(), False),\n  StructField(\"CalendarMonthName\", StringType(),  False),\n  StructField(\"CalendarMonthFullName\", StringType(), False),\n  StructField(\"CalendarYearWeek\", IntegerType(), False),\n  StructField(\"CalendarWeek\",  IntegerType(), False)\n])\n\ninputLogMessageSchema = StructType([\n  StructField(\"logMessage\", StringType(), False)\n])",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T13:00:27+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1059802358",
      "id": "20220810-113330_677056882",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "FINISHED",
      "$$hashKey": "object:898",
      "dateFinished": "2023-07-13T13:00:27+0000",
      "dateStarted": "2023-07-13T13:00:27+0000"
    },
    {
      "title": "Set notebook args(for testing purposes only)",
      "text": "%pyspark\nif is_notebook():\n sys.argv=['','{\"MaintenancePathPrefix\": '\n '\"/JUPITER/RAW/#MAINTENANCE/2023-07-13_manual__2023-07-13T11%3A13%3A59.133488%2B00%3A00_\", '\n '\"ProcessDate\": \"2023-07-13\", \"Schema\": \"Jupiter\", \"HandlerId\": '\n '\"b7e6ef3c-afaa-43f9-bdf2-3fb01e12a433\"}']\n \n sc.addPyFile(\"hdfs:///SRC/SHARED/EXTRACT_SETTING.py\")\n sc.addPyFile(\"hdfs:///SRC/SHARED/SUPPORT_FUNCTIONS.py\")",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T13:00:27+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/python",
        "fontSize": 9,
        "title": true,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1389908951",
      "id": "paragraph_1660132953861_1696933688",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "FINISHED",
      "$$hashKey": "object:899",
      "dateFinished": "2023-07-13T13:00:27+0000",
      "dateStarted": "2023-07-13T13:00:27+0000"
    },
    {
      "text": "%pyspark\nspark = SparkSession.builder.appName('Jupiter - PySpark').getOrCreate()\nsc = SparkContext.getOrCreate();\n\nimport EXTRACT_SETTING as es\n\nSETTING_RAW_DIR = es.SETTING_RAW_DIR\nDATE_DIR=es.DATE_DIR\n\nEXTRACT_ENTITIES_AUTO_PATH = f'{es.HDFS_PREFIX}{es.MAINTENANCE_PATH_PREFIX}EXTRACT_ENTITIES_AUTO.csv'\nprocessDate=es.processDate\npipelineRunId=es.pipelineRunId\nhandlerId=es.input_params.get(\"HandlerId\")\n\nprint(f'EXTRACT_ENTITIES_AUTO_PATH={EXTRACT_ENTITIES_AUTO_PATH}')\n\nimport SUPPORT_FUNCTIONS as sp",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T13:00:28+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "INPUT_PARAMS={\"MaintenancePathPrefix\": \"/JUPITER/RAW/#MAINTENANCE/2023-07-13_manual__2023-07-13T11%3A13%3A59.133488%2B00%3A00_\", \"ProcessDate\": \"2023-07-13\", \"Schema\": \"Jupiter\", \"HandlerId\": \"b7e6ef3c-afaa-43f9-bdf2-3fb01e12a433\"}\nSETTINGS_PATH=hdfs:///JUPITER/RAW/#MAINTENANCE/2023-07-13_manual__2023-07-13T11%3A13%3A59.133488%2B00%3A00_PARAMETERS.csv\nhdfs:///JUPITER/RAW/#MAINTENANCE/2023-07-13_manual__2023-07-13T11%3A13%3A59.133488%2B00%3A00_PARAMETERS.csv\n\nprocessDate: 2023-07-13\npipelineRunId: manual__2023-07-13T11%3A13%3A59.133488%2B00%3A00\npipelineSubfolderName: None\n\nSETTING_RAW_DIR: hdfs:///JUPITER/RAW\nSETTING_PROCESS_DIR: hdfs:///JUPITER/PROCESS\nSETTING_OUTPUT_DIR: hdfs:///JUPITER/OUTPUT\nMAINTENANCE_PATH_PREFIX: /JUPITER/RAW/#MAINTENANCE/2023-07-13_manual__2023-07-13T11%3A13%3A59.133488%2B00%3A00_\nSYSTEM_NAME: JUPITER\nSETTING_BRANCH_NAME: \nOther settings - list \"systemParametersDF\" data frame\nEXTRACT_ENTITIES_AUTO_PATH=hdfs:///JUPITER/RAW/#MAINTENANCE/2023-07-13_manual__2023-07-13T11%3A13%3A59.133488%2B00%3A00_EXTRACT_ENTITIES_AUTO.csv\nDefined functions:\ngetFilesList(path) - list files recursively\n    path - root path\ngetShowString(df, n=20, truncate=True, vertical=False) - prints Spark DataFrame\ngetSchemasMap(schemas_dir) - creates dictionanry with Spark Schemas, schemas_dir - directory with json files with schemas\n"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {
        "jobUrl": {
          "propertyName": "jobUrl",
          "label": "SPARK JOB",
          "tooltip": "View in Spark web UI",
          "group": "spark",
          "values": [
            {
              "jobUrl": "https://ui-c9q0pukbr2ivf12r83k8-rc1a-dataproc-d-bam57uve6lsefmrc-40505.dataproc-ui.yandexcloud.net/jobs/job?id=0",
              "$$hashKey": "object:6039"
            },
            {
              "jobUrl": "https://ui-c9q0pukbr2ivf12r83k8-rc1a-dataproc-d-bam57uve6lsefmrc-40505.dataproc-ui.yandexcloud.net/jobs/job?id=1",
              "$$hashKey": "object:6040"
            },
            {
              "jobUrl": "https://ui-c9q0pukbr2ivf12r83k8-rc1a-dataproc-d-bam57uve6lsefmrc-40505.dataproc-ui.yandexcloud.net/jobs/job?id=2",
              "$$hashKey": "object:6041"
            },
            {
              "jobUrl": "https://ui-c9q0pukbr2ivf12r83k8-rc1a-dataproc-d-bam57uve6lsefmrc-40505.dataproc-ui.yandexcloud.net/jobs/job?id=3",
              "$$hashKey": "object:6042"
            },
            {
              "jobUrl": "https://ui-c9q0pukbr2ivf12r83k8-rc1a-dataproc-d-bam57uve6lsefmrc-40505.dataproc-ui.yandexcloud.net/jobs/job?id=4",
              "$$hashKey": "object:6043"
            },
            {
              "jobUrl": "https://ui-c9q0pukbr2ivf12r83k8-rc1a-dataproc-d-bam57uve6lsefmrc-40505.dataproc-ui.yandexcloud.net/jobs/job?id=5",
              "$$hashKey": "object:6044"
            },
            {
              "jobUrl": "https://ui-c9q0pukbr2ivf12r83k8-rc1a-dataproc-d-bam57uve6lsefmrc-40505.dataproc-ui.yandexcloud.net/jobs/job?id=6",
              "$$hashKey": "object:6045"
            }
          ],
          "interpreterSettingId": "spark"
        }
      },
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1214503770",
      "id": "20220810-113330_824588436",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "FINISHED",
      "$$hashKey": "object:900",
      "dateFinished": "2023-07-13T13:00:36+0000",
      "dateStarted": "2023-07-13T13:00:28+0000"
    },
    {
      "text": "%pyspark\nschema = es.input_params.get(\"Schema\")",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T13:00:36+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1247347486",
      "id": "20220810-113330_449807321",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "FINISHED",
      "$$hashKey": "object:901",
      "dateFinished": "2023-07-13T13:00:36+0000",
      "dateStarted": "2023-07-13T13:00:36+0000"
    },
    {
      "text": "%pyspark\r\nDIRECTORY = SETTING_RAW_DIR + '/SOURCES/'\r\n\r\nPROMO_PATH = DIRECTORY + 'JUPITER/Promo'\r\nPROMOSTATUS_PATH = DIRECTORY + 'JUPITER/PromoStatus'\r\nPRODUCT_PATH = DIRECTORY + 'JUPITER/Product'\r\nBRANDTECH_PATH = DIRECTORY + 'JUPITER/BrandTech'\r\nPROMOPRODUCT_PATH = DIRECTORY + 'JUPITER/PromoProduct'\r\nCLIENTHIERARCHY_PATH = DIRECTORY + 'JUPITER/ClientTreeHierarchyView'\r\nPROMOPRODUCTTREE_PATH = DIRECTORY + 'JUPITER/PromoProductTree'\r\nCHANGESINCIDENTS_PATH = DIRECTORY + 'JUPITER/ChangesIncident'\r\nPRODUCTCHANGEINCIDENTS_PATH = DIRECTORY + 'JUPITER/ProductChangeIncident'\r\n\r\nDATESDIM_PATH = DIRECTORY + 'UNIVERSALCATALOG/MARS_UNIVERSAL_CALENDAR.csv'\r\n\r\nASSORTMENTMATRIX_PATH = DIRECTORY + 'JUPITER/AssortmentMatrix'\r\nPRICELIST_PATH = DIRECTORY + 'JUPITER/PriceList'\r\nBASELINE_PATH = DIRECTORY + 'JUPITER/BaseLine'\r\nINCREASEBASELINE_PATH = DIRECTORY + 'JUPITER/IncreaseBaseLine'\r\nSHARES_PATH = DIRECTORY + 'JUPITER/ClientTreeBrandTech'\r\nCLIENTTREE_PATH = DIRECTORY + 'JUPITER/ClientTree'\r\nPRODUCTTREE_PATH = DIRECTORY + 'JUPITER/ProductTree'\r\nINCREMENTAL_PATH = DIRECTORY + 'JUPITER/IncrementalPromo'\r\nCOGS_PATH = DIRECTORY + 'JUPITER/COGS'\r\nCOGSTN_PATH = DIRECTORY + 'JUPITER/PlanCOGSTn'\r\nTI_PATH = DIRECTORY + 'JUPITER/TradeInvestment'\r\nCORRECTION_PATH = DIRECTORY + 'JUPITER/PromoProductsCorrection'\r\nPLANPOSTPROMOEFFECT_PATH = DIRECTORY + 'JUPITER/PlanPostPromoEffect'\r\n\r\nBLOCKEDPROMO_OUTPUT_PATH = es.SETTING_PROCESS_DIR + '/BlockedPromo/BlockedPromo.parquet'\r\nBLOCKEDPROMO_OUTPUT_PATH_CSV = es.SETTING_PROCESS_DIR + '/BlockedPromo/BlockedPromo.CSV'\r\n\r\nBLOCKEDINCREASEPROMO_OUTPUT_PATH = es.SETTING_PROCESS_DIR + '/BlockedPromo/BlockedIncreasePromo.parquet'\r\nBLOCKEDINCREASEPROMO_OUTPUT_PATH_CSV = es.SETTING_PROCESS_DIR + '/BlockedPromo/BlockedIncreasePromo.CSV'\r\n\r\n\r\nCHANGESINCIDENTS_OUTPUT_PATH = es.SETTING_OUTPUT_DIR + '/ChangesIncident/ChangesIncident.CSV'\r\nPRODUCTCHANGEINCIDENTS_OUTPUT_PATH = es.SETTING_OUTPUT_DIR + '/ProductChangeIncident/ProductChangeIncident.CSV'\r\n\r\nINPUT_FILE_LOG_PATH = es.SETTING_PROCESS_DIR + '/Logs/' + handlerId + '.csv'\r\n# OUTPUT_LOG_PATH =  es.SETTING_PROCESS_DIR + '/Logs/'\r\n# OUTPUT_FILE_LOG_PATH = OUTPUT_LOG_PATH + handlerId + '.csv'\r\n# OUTPUT_TEMP_FILE_LOG_PATH = OUTPUT_LOG_PATH + handlerId + 'temp.csv'",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T13:00:36+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1112678251",
      "id": "20220810-113330_1797622225",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "FINISHED",
      "$$hashKey": "object:902",
      "dateFinished": "2023-07-13T13:00:36+0000",
      "dateStarted": "2023-07-13T13:00:36+0000"
    },
    {
      "title": "Load raw entities schemas from json files to map",
      "text": "%pyspark\nSCHEMAS_DIR=SETTING_RAW_DIR + '/SCHEMAS/'\nschemas_map = sp.getSchemasMap(SCHEMAS_DIR)",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T13:39:13+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/python",
        "fontSize": 9,
        "title": true,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "hdfs:///JUPITER/RAW/SCHEMAS/\n{'ActualCOGS': StructType(List(StructField(Id,StringType,true),StructField(IsCOGSIncidentCreated,BooleanType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(ClientTreeId,IntegerType,true),StructField(BrandTechId,StringType,true),StructField(StartDate,TimestampType,true),StructField(EndDate,TimestampType,true),StructField(LSVpercent,FloatType,true),StructField(Year,IntegerType,true),StructField(#QCCount,IntegerType,true))), 'ActualCOGSTn': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(ClientTreeId,IntegerType,true),StructField(BrandTechId,StringType,true),StructField(StartDate,TimestampType,true),StructField(EndDate,TimestampType,true),StructField(Year,IntegerType,true),StructField(IsCOGSIncidentCreated,BooleanType,true),StructField(TonCost,DoubleType,true),StructField(#QCCount,IntegerType,true))), 'ActualTradeInvestment': StructType(List(StructField(Id,StringType,true),StructField(IsTIIncidentCreated,BooleanType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(StartDate,TimestampType,true),StructField(EndDate,TimestampType,true),StructField(ClientTreeId,IntegerType,true),StructField(BrandTechId,StringType,true),StructField(TIType,StringType,true),StructField(TISubType,StringType,true),StructField(SizePercent,FloatType,true),StructField(MarcCalcROI,BooleanType,true),StructField(MarcCalcBudgets,BooleanType,true),StructField(Year,IntegerType,true),StructField(#QCCount,IntegerType,true))), 'AssortmentMatrix': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(ClientTreeId,IntegerType,true),StructField(StartDate,TimestampType,true),StructField(EndDate,TimestampType,true),StructField(ProductId,StringType,true),StructField(CreateDate,TimestampType,true),StructField(Number,IntegerType,true),StructField(#QCCount,IntegerType,true))), 'BTL': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(Number,IntegerType,true),StructField(PlanBTLTotal,DoubleType,true),StructField(ActualBTLTotal,DoubleType,true),StructField(StartDate,TimestampType,true),StructField(EndDate,TimestampType,true),StructField(InvoiceNumber,StringType,true),StructField(EventId,StringType,true),StructField(#QCCount,IntegerType,true))), 'BTLPromo': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(BTLId,StringType,true),StructField(PromoId,StringType,true),StructField(ClientTreeId,IntegerType,true),StructField(#QCCount,IntegerType,true))), 'BaseLine': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(StartDate,TimestampType,true),StructField(Type,IntegerType,true),StructField(ProductId,StringType,true),StructField(LastModifiedDate,TimestampType,true),StructField(DemandCode,StringType,true),StructField(InputBaselineQTY,DoubleType,true),StructField(SellInBaselineQTY,DoubleType,true),StructField(SellOutBaselineQTY,DoubleType,true),StructField(NeedProcessing,BooleanType,true),StructField(#QCCount,IntegerType,true))), 'BrandTech': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(BrandId,StringType,true),StructField(TechnologyId,StringType,true),StructField(Name,StringType,true),StructField(BrandTech_code,StringType,true),StructField(BrandsegTechsub_code,StringType,true),StructField(BrandsegTechsub,StringType,true),StructField(TechSubName,StringType,true),StructField(TechSubNameRU,StringType,true),StructField(BrandsegTechsubRU,StringType,true),StructField(#QCCount,IntegerType,true))), 'BudgetItem': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(Name,StringType,true),StructField(BudgetId,StringType,true),StructField(ButtonColor,StringType,true),StructField(Description_ru,StringType,true),StructField(#QCCount,IntegerType,true))), 'BudgetSubItem': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(Name,StringType,true),StructField(BudgetItemId,StringType,true),StructField(Description_ru,StringType,true),StructField(#QCCount,IntegerType,true))), 'COGS': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(StartDate,TimestampType,true),StructField(EndDate,TimestampType,true),StructField(ClientTreeId,IntegerType,true),StructField(BrandTechId,StringType,true),StructField(Year,IntegerType,true),StructField(LSVpercent,FloatType,true),StructField(#QCCount,IntegerType,true))), 'ChangesIncident': StructType(List(StructField(Id,StringType,true),StructField(DirectoryName,StringType,true),StructField(ItemId,StringType,true),StructField(CreateDate,TimestampType,true),StructField(ProcessDate,TimestampType,true),StructField(DeletedDate,TimestampType,true),StructField(Disabled,IntegerType,true),StructField(#QCCount,IntegerType,true))), 'ClientTree': StructType(List(StructField(Id,IntegerType,true),StructField(depth,IntegerType,true),StructField(Type,StringType,true),StructField(Name,StringType,true),StructField(StartDate,TimestampType,true),StructField(EndDate,TimestampType,true),StructField(DemandCode,StringType,true),StructField(IsBaseClient,BooleanType,true),StructField(IsBeforeStart,BooleanType,true),StructField(DaysStart,IntegerType,true),StructField(IsBeforeEnd,BooleanType,true),StructField(DaysEnd,IntegerType,true),StructField(IsDaysStart,BooleanType,true),StructField(IsDaysEnd,BooleanType,true),StructField(ObjectId,IntegerType,true),StructField(parentId,IntegerType,true),StructField(RetailTypeName,StringType,true),StructField(FullPathName,StringType,true),StructField(LogoFileName,StringType,true),StructField(GHierarchyCode,StringType,true),StructField(DMDGroup,StringType,true),StructField(IsOnInvoice,BooleanType,true),StructField(DeviationCoefficient,DoubleType,true),StructField(DistrMarkUp,DoubleType,true),StructField(SFAClientCode,StringType,true),StructField(#QCCount,IntegerType,true))), 'ClientTreeBrandTech': StructType(List(StructField(Id,StringType,true),StructField(ClientTreeId,IntegerType,true),StructField(BrandTechId,StringType,true),StructField(Share,DoubleType,true),StructField(ParentClientTreeDemandCode,StringType,true),StructField(CurrentBrandTechName,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(#QCCount,IntegerType,true))), 'ClientTreeHierarchyView': StructType(List(StructField(Id,IntegerType,true),StructField(Hierarchy,StringType,true),StructField(#QCCount,IntegerType,true))), 'IncrementalPromo': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(PromoId,StringType,true),StructField(ProductId,StringType,true),StructField(PlanPromoIncrementalCases,DoubleType,true),StructField(PlanPromoIncrementalLSV,DoubleType,true),StructField(LastModifiedDate,TimestampType,true),StructField(CasePrice,DoubleType,true),StructField(TPMmode,IntegerType,true),StructField(#QCCount,IntegerType,true))), 'PlanCOGSTn': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(ClientTreeId,IntegerType,true),StructField(BrandTechId,StringType,true),StructField(StartDate,TimestampType,true),StructField(EndDate,TimestampType,true),StructField(Year,IntegerType,true),StructField(TonCost,DoubleType,true),StructField(#QCCount,IntegerType,true))), 'PlanIncrementalReport': StructType(List(StructField(Id,StringType,true),StructField(ZREP,StringType,true),StructField(DemandCode,StringType,true),StructField(InOut,BooleanType,true),StructField(PromoNameId,StringType,true),StructField(PromoNumber,IntegerType,true),StructField(LocApollo,StringType,true),StructField(TypeApollo,StringType,true),StructField(ModelApollo,StringType,true),StructField(WeekStartDate,TimestampType,true),StructField(PlanProductIncrementalCaseQty,DoubleType,true),StructField(PlanProductBaselineCaseQty,DoubleType,true),StructField(PlanProductIncrementalLSV,DoubleType,true),StructField(PlanProductBaselineLSV,DoubleType,true),StructField(PlanUplift,DoubleType,true),StructField(DispatchesStart,TimestampType,true),StructField(DispatchesEnd,TimestampType,true),StructField(IsGrowthAcceleration,BooleanType,true),StructField(Week,StringType,true),StructField(Status,StringType,true),StructField(#QCCount,IntegerType,true))), 'PriceList': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(StartDate,TimestampType,true),StructField(EndDate,TimestampType,true),StructField(ProductId,StringType,true),StructField(Price,DoubleType,true),StructField(ClientTreeId,IntegerType,true),StructField(ModifiedDate,TimestampType,true),StructField(FuturePriceMarker,IntegerType,true),StructField(#QCCount,IntegerType,true))), 'Product': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(ProductEN,StringType,true),StructField(BrandFlag,StringType,true),StructField(IngredientVariety,StringType,true),StructField(ProductCategory,StringType,true),StructField(ProductType,StringType,true),StructField(MarketSegment,StringType,true),StructField(SupplySegment,StringType,true),StructField(FunctionalVariety,StringType,true),StructField(Size,StringType,true),StructField(BrandEssence,StringType,true),StructField(PackType,StringType,true),StructField(GroupSize,StringType,true),StructField(TradedUnitFormat,StringType,true),StructField(ConsumerPackFormat,StringType,true),StructField(BrandFlagAbbr,StringType,true),StructField(SubmarkFlag,StringType,true),StructField(ZREP,StringType,true),StructField(EAN_Case,StringType,true),StructField(UOM_PC2Case,IntegerType,true),StructField(EAN_PC,StringType,true),StructField(Brand_code,StringType,true),StructField(Tech_code,StringType,true),StructField(Segmen_code,StringType,true),StructField(Division,IntegerType,true),StructField(SubBrand_code,StringType,true),StructField(Brand,StringType,true),StructField(Technology,StringType,true),StructField(SubBrand,StringType,true),StructField(BrandTech,StringType,true),StructField(BrandTech_code,StringType,true),StructField(Brandsegtech,StringType,true),StructField(Brandsegtech_code,StringType,true),StructField(BrandsegTechSub,StringType,true),StructField(BrandsegTechSub_code,StringType,true),StructField(NetWeight,DoubleType,true),StructField(UOM,StringType,true),StructField(CaseVolume,DoubleType,true),StructField(PCVolume,DoubleType,true),StructField(#QCCount,IntegerType,true))), 'ProductChangeIncident': StructType(List(StructField(Id,StringType,true),StructField(ProductId,StringType,true),StructField(CreateDate,TimestampType,true),StructField(IsCreate,BooleanType,true),StructField(IsDelete,BooleanType,true),StructField(NotificationProcessDate,TimestampType,true),StructField(RecalculationProcessDate,TimestampType,true),StructField(IsCreateInMatrix,BooleanType,true),StructField(IsDeleteInMatrix,BooleanType,true),StructField(RecalculatedPromoId,StringType,true),StructField(AddedProductIds,StringType,true),StructField(ExcludedProductIds,StringType,true),StructField(IsChecked,BooleanType,true),StructField(IsRecalculated,BooleanType,true),StructField(Disabled,IntegerType,true),StructField(#QCCount,IntegerType,true))), 'ProductTree': StructType(List(StructField(Id,IntegerType,true),StructField(depth,IntegerType,true),StructField(Name,StringType,true),StructField(StartDate,TimestampType,true),StructField(EndDate,TimestampType,true),StructField(Type,StringType,true),StructField(Abbreviation,StringType,true),StructField(Filter,StringType,true),StructField(ObjectId,IntegerType,true),StructField(parentId,IntegerType,true),StructField(FullPathName,StringType,true),StructField(BrandId,StringType,true),StructField(TechnologyId,StringType,true),StructField(NodePriority,IntegerType,true),StructField(LogoFileName,StringType,true),StructField(FilterQuery,StringType,true),StructField(Description_ru,StringType,true),StructField(#QCCount,IntegerType,true))), 'Promo': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(BrandId,StringType,true),StructField(BrandTechId,StringType,true),StructField(PromoStatusId,StringType,true),StructField(Name,StringType,true),StructField(StartDate,TimestampType,true),StructField(EndDate,TimestampType,true),StructField(DispatchesStart,TimestampType,true),StructField(DispatchesEnd,TimestampType,true),StructField(ColorId,StringType,true),StructField(Number,IntegerType,true),StructField(RejectReasonId,StringType,true),StructField(EventId,StringType,true),StructField(MarsMechanicId,StringType,true),StructField(MarsMechanicTypeId,StringType,true),StructField(PlanInstoreMechanicId,StringType,true),StructField(PlanInstoreMechanicTypeId,StringType,true),StructField(MarsMechanicDiscount,DoubleType,true),StructField(OtherEventName,StringType,true),StructField(EventName,StringType,true),StructField(ClientHierarchy,StringType,true),StructField(ProductHierarchy,StringType,true),StructField(CreatorId,StringType,true),StructField(MarsStartDate,StringType,true),StructField(MarsEndDate,StringType,true),StructField(MarsDispatchesStart,StringType,true),StructField(MarsDispatchesEnd,StringType,true),StructField(ClientTreeId,IntegerType,true),StructField(BaseClientTreeId,IntegerType,true),StructField(Mechanic,StringType,true),StructField(MechanicIA,StringType,true),StructField(BaseClientTreeIds,StringType,true),StructField(LastApprovedDate,TimestampType,true),StructField(TechnologyId,StringType,true),StructField(NeedRecountUplift,IntegerType,true),StructField(IsAutomaticallyApproved,IntegerType,true),StructField(IsCMManagerApproved,IntegerType,true),StructField(IsDemandPlanningApproved,IntegerType,true),StructField(IsDemandFinanceApproved,IntegerType,true),StructField(PlanPromoXSites,DoubleType,true),StructField(PlanPromoCatalogue,DoubleType,true),StructField(PlanPromoPOSMInClient,DoubleType,true),StructField(PlanPromoCostProdXSites,DoubleType,true),StructField(PlanPromoCostProdCatalogue,DoubleType,true),StructField(PlanPromoCostProdPOSMInClient,DoubleType,true),StructField(ActualPromoXSites,DoubleType,true),StructField(ActualPromoCatalogue,DoubleType,true),StructField(ActualPromoPOSMInClient,DoubleType,true),StructField(ActualPromoCostProdXSites,DoubleType,true),StructField(ActualPromoCostProdCatalogue,DoubleType,true),StructField(ActualPromoCostProdPOSMInClient,DoubleType,true),StructField(MechanicComment,StringType,true),StructField(PlanInstoreMechanicDiscount,DoubleType,true),StructField(CalendarPriority,IntegerType,true),StructField(PlanPromoTIShopper,DoubleType,true),StructField(PlanPromoTIMarketing,DoubleType,true),StructField(PlanPromoBranding,DoubleType,true),StructField(PlanPromoCost,DoubleType,true),StructField(PlanPromoBTL,DoubleType,true),StructField(PlanPromoCostProduction,DoubleType,true),StructField(PlanPromoUpliftPercent,DoubleType,true),StructField(PlanPromoIncrementalLSV,DoubleType,true),StructField(PlanPromoLSV,DoubleType,true),StructField(PlanPromoROIPercent,DoubleType,true),StructField(PlanPromoIncrementalNSV,DoubleType,true),StructField(PlanPromoNetIncrementalNSV,DoubleType,true),StructField(PlanPromoIncrementalMAC,DoubleType,true),StructField(ActualPromoTIShopper,DoubleType,true),StructField(ActualPromoTIMarketing,DoubleType,true),StructField(ActualPromoBranding,DoubleType,true),StructField(ActualPromoBTL,DoubleType,true),StructField(ActualPromoCostProduction,DoubleType,true),StructField(ActualPromoCost,DoubleType,true),StructField(ActualPromoUpliftPercent,DoubleType,true),StructField(ActualPromoIncrementalLSV,DoubleType,true),StructField(ActualPromoLSV,DoubleType,true),StructField(ActualPromoROIPercent,DoubleType,true),StructField(ActualPromoIncrementalNSV,DoubleType,true),StructField(ActualPromoNetIncrementalNSV,DoubleType,true),StructField(ActualPromoIncrementalMAC,DoubleType,true),StructField(ActualInStoreMechanicId,StringType,true),StructField(ActualInStoreMechanicTypeId,StringType,true),StructField(PromoDuration,IntegerType,true),StructField(DispatchDuration,IntegerType,true),StructField(InvoiceNumber,StringType,true),StructField(PlanPromoBaselineLSV,DoubleType,true),StructField(PlanPromoIncrementalBaseTI,DoubleType,true),StructField(PlanPromoIncrementalCOGS,DoubleType,true),StructField(PlanPromoTotalCost,DoubleType,true),StructField(PlanPromoNetIncrementalLSV,DoubleType,true),StructField(PlanPromoNetLSV,DoubleType,true),StructField(PlanPromoNetIncrementalMAC,DoubleType,true),StructField(PlanPromoIncrementalEarnings,DoubleType,true),StructField(PlanPromoNetIncrementalEarnings,DoubleType,true),StructField(PlanPromoNetROIPercent,DoubleType,true),StructField(PlanPromoNetUpliftPercent,DoubleType,true),StructField(ActualPromoBaselineLSV,DoubleType,true),StructField(ActualInStoreDiscount,DoubleType,true),StructField(ActualInStoreShelfPrice,DoubleType,true),StructField(ActualPromoIncrementalBaseTI,DoubleType,true),StructField(ActualPromoIncrementalCOGS,DoubleType,true),StructField(ActualPromoTotalCost,DoubleType,true),StructField(ActualPromoNetIncrementalLSV,DoubleType,true),StructField(ActualPromoNetLSV,DoubleType,true),StructField(ActualPromoNetIncrementalMAC,DoubleType,true),StructField(ActualPromoIncrementalEarnings,DoubleType,true),StructField(ActualPromoNetIncrementalEarnings,DoubleType,true),StructField(ActualPromoNetROIPercent,DoubleType,true),StructField(ActualPromoNetUpliftPercent,DoubleType,true),StructField(Calculating,IntegerType,true),StructField(BlockInformation,StringType,true),StructField(PlanPromoBaselineBaseTI,DoubleType,true),StructField(PlanPromoBaseTI,DoubleType,true),StructField(PlanPromoNetNSV,DoubleType,true),StructField(ActualPromoBaselineBaseTI,DoubleType,true),StructField(ActualPromoBaseTI,DoubleType,true),StructField(ActualPromoNetNSV,DoubleType,true),StructField(ProductSubrangesList,StringType,true),StructField(ClientTreeKeyId,IntegerType,true),StructField(InOut,IntegerType,true),StructField(PlanPromoNetIncrementalBaseTI,DoubleType,true),StructField(PlanPromoNetIncrementalCOGS,DoubleType,true),StructField(ActualPromoNetIncrementalBaseTI,DoubleType,true),StructField(ActualPromoNetIncrementalCOGS,DoubleType,true),StructField(PlanPromoNetBaseTI,DoubleType,true),StructField(PlanPromoNSV,DoubleType,true),StructField(ActualPromoNetBaseTI,DoubleType,true),StructField(ActualPromoNSV,DoubleType,true),StructField(ActualPromoLSVByCompensation,DoubleType,true),StructField(PlanInStoreShelfPrice,DoubleType,true),StructField(PlanPromoPostPromoEffectLSVW1,DoubleType,true),StructField(PlanPromoPostPromoEffectLSVW2,DoubleType,true),StructField(PlanPromoPostPromoEffectLSV,DoubleType,true),StructField(ActualPromoPostPromoEffectLSVW1,DoubleType,true),StructField(ActualPromoPostPromoEffectLSVW2,DoubleType,true),StructField(ActualPromoPostPromoEffectLSV,DoubleType,true),StructField(LoadFromTLC,IntegerType,true),StructField(InOutProductIds,StringType,true),StructField(InOutExcludeAssortmentMatrixProductsButtonPressed,IntegerType,true),StructField(DocumentNumber,StringType,true),StructField(LastChangedDate,TimestampType,true),StructField(LastChangedDateDemand,TimestampType,true),StructField(LastChangedDateFinance,TimestampType,true),StructField(RegularExcludedProductIds,StringType,true),StructField(AdditionalUserTimestamp,StringType,true),StructField(IsGrowthAcceleration,IntegerType,true),StructField(PromoTypesId,StringType,true),StructField(CreatorLogin,StringType,true),StructField(PlanTIBasePercent,DoubleType,true),StructField(PlanCOGSPercent,DoubleType,true),StructField(ActualTIBasePercent,DoubleType,true),StructField(ActualCOGSPercent,DoubleType,true),StructField(SumInvoice,DoubleType,true),StructField(IsOnInvoice,IntegerType,true),StructField(ActualPromoLSVSI,DoubleType,true),StructField(ActualPromoLSVSO,DoubleType,true),StructField(IsApolloExport,IntegerType,true),StructField(DeviationCoefficient,DoubleType,true),StructField(UseActualTI,IntegerType,true),StructField(UseActualCOGS,IntegerType,true),StructField(BudgetYear,IntegerType,true),StructField(PlanAddTIShopperApproved,DoubleType,true),StructField(PlanAddTIShopperCalculated,DoubleType,true),StructField(PlanAddTIMarketingApproved,DoubleType,true),StructField(ActualAddTIShopper,DoubleType,true),StructField(ActualAddTIMarketing,DoubleType,true),StructField(ProductSubrangesListRU,StringType,true),StructField(ManualInputSumInvoice,IntegerType,true),StructField(IsSplittable,IntegerType,true),StructField(PlanPromoBaselineVolume,DoubleType,true),StructField(PlanPromoPostPromoEffectVolume,DoubleType,true),StructField(PlanPromoPostPromoEffectVolumeW1,DoubleType,true),StructField(PlanPromoPostPromoEffectVolumeW2,DoubleType,true),StructField(PlanPromoIncrementalVolume,DoubleType,true),StructField(PlanPromoNetIncrementalVolume,DoubleType,true),StructField(ActualPromoBaselineVolume,DoubleType,true),StructField(ActualPromoPostPromoEffectVolume,DoubleType,true),StructField(ActualPromoVolumeByCompensation,DoubleType,true),StructField(ActualPromoVolumeSI,DoubleType,true),StructField(ActualPromoVolume,DoubleType,true),StructField(ActualPromoIncrementalVolume,DoubleType,true),StructField(ActualPromoNetIncrementalVolume,DoubleType,true),StructField(PlanPromoIncrementalCOGSTn,DoubleType,true),StructField(PlanPromoNetIncrementalCOGSTn,DoubleType,true),StructField(ActualPromoIncrementalCOGSTn,DoubleType,true),StructField(ActualPromoNetIncrementalCOGSTn,DoubleType,true),StructField(IsLSVBased,IntegerType,true),StructField(PlanPromoIncrementalMACLSV,DoubleType,true),StructField(PlanPromoNetIncrementalMACLSV,DoubleType,true),StructField(ActualPromoIncrementalMACLSV,DoubleType,true),StructField(ActualPromoNetIncrementalMACLSV,DoubleType,true),StructField(PlanPromoIncrementalEarningsLSV,DoubleType,true),StructField(PlanPromoNetIncrementalEarningsLSV,DoubleType,true),StructField(ActualPromoIncrementalEarningsLSV,DoubleType,true),StructField(ActualPromoNetIncrementalEarningsLSV,DoubleType,true),StructField(PlanPromoROIPercentLSV,DoubleType,true),StructField(PlanPromoNetROIPercentLSV,DoubleType,true),StructField(ActualPromoROIPercentLSV,DoubleType,true),StructField(ActualPromoNetROIPercentLSV,DoubleType,true),StructField(PlanCOGSTn,DoubleType,true),StructField(ActualCOGSTn,DoubleType,true),StructField(MasterPromoId,StringType,true),StructField(IsInExchange,IntegerType,true),StructField(LinkedPromoes,StringType,true),StructField(IsGAManagerApproved,IntegerType,true),StructField(TPMmode,IntegerType,true),StructField(RollingScenarioId,StringType,true),StructField(ModifiedDate,TimestampType,true),StructField(NeedRecountUpliftPI,IntegerType,true),StructField(PlanPromoUpliftPercentPI,DoubleType,true),StructField(IsPriceIncrease,IntegerType,true),StructField(MLPromoId,StringType,true),StructField(CalculateML,IntegerType,true),StructField(#QCCount,IntegerType,true))), 'PromoPriceIncrease': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(PlanPromoUpliftPercent,DoubleType,true),StructField(PlanPromoBaselineLSV,DoubleType,true),StructField(PlanPromoIncrementalLSV,DoubleType,true),StructField(PlanPromoLSV,DoubleType,true),StructField(PlanPromoPostPromoEffectLSV,DoubleType,true),StructField(PlanPromoPostPromoEffectLSVW1,DoubleType,true),StructField(PlanPromoPostPromoEffectLSVW2,DoubleType,true),StructField(PlanPromoPostPromoEffectVolumeW1,DoubleType,true),StructField(PlanPromoPostPromoEffectVolumeW2,DoubleType,true),StructField(PlanPromoPostPromoEffectVolume,DoubleType,true),StructField(PlanPromoBaselineVolume,DoubleType,true),StructField(PlanPromoTIShopper,DoubleType,true),StructField(PlanPromoCost,DoubleType,true),StructField(PlanPromoIncrementalCOGS,DoubleType,true),StructField(PlanPromoBaseTI,DoubleType,true),StructField(PlanPromoIncrementalBaseTI,DoubleType,true),StructField(PlanPromoTotalCost,DoubleType,true),StructField(PlanPromoNetIncrementalLSV,DoubleType,true),StructField(PlanPromoNetLSV,DoubleType,true),StructField(PlanPromoNetIncrementalBaseTI,DoubleType,true),StructField(PlanPromoNetIncrementalCOGS,DoubleType,true),StructField(PlanPromoNetBaseTI,DoubleType,true),StructField(PlanPromoBaselineBaseTI,DoubleType,true),StructField(PlanPromoNSV,DoubleType,true),StructField(PlanPromoIncrementalNSV,DoubleType,true),StructField(PlanPromoNetIncrementalNSV,DoubleType,true),StructField(PlanPromoNetIncrementalMAC,DoubleType,true),StructField(PlanPromoIncrementalVolume,DoubleType,true),StructField(PlanPromoNetIncrementalVolume,DoubleType,true),StructField(PlanPromoNetNSV,DoubleType,true),StructField(PlanPromoIncrementalCOGSTn,DoubleType,true),StructField(PlanPromoNetIncrementalCOGSTn,DoubleType,true),StructField(PlanPromoIncrementalMAC,DoubleType,true),StructField(PlanPromoIncrementalEarnings,DoubleType,true),StructField(PlanPromoNetIncrementalEarnings,DoubleType,true),StructField(PlanPromoROIPercent,DoubleType,true),StructField(PlanPromoNetROIPercent,DoubleType,true),StructField(PlanPromoNetIncrementalMACLSV,DoubleType,true),StructField(PlanPromoIncrementalMACLSV,DoubleType,true),StructField(PlanPromoIncrementalEarningsLSV,DoubleType,true),StructField(PlanPromoNetIncrementalEarningsLSV,DoubleType,true),StructField(PlanPromoROIPercentLSV,DoubleType,true),StructField(PlanPromoNetROIPercentLSV,DoubleType,true),StructField(PlanAddTIShopperCalculated,DoubleType,true),StructField(PlanAddTIShopperApproved,DoubleType,true),StructField(PlanPromoNetUpliftPercent,DoubleType,true),StructField(#QCCount,IntegerType,true))), 'PromoProduct': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(ZREP,StringType,true),StructField(PromoId,StringType,true),StructField(ProductId,StringType,true),StructField(EAN_Case,StringType,true),StructField(PlanProductPCQty,IntegerType,true),StructField(PlanProductPCLSV,DoubleType,true),StructField(ActualProductPCQty,IntegerType,true),StructField(ActualProductUOM,StringType,true),StructField(ActualProductSellInPrice,DoubleType,true),StructField(ActualProductShelfDiscount,DoubleType,true),StructField(ActualProductPCLSV,DoubleType,true),StructField(ActualProductUpliftPercent,DoubleType,true),StructField(ActualProductIncrementalPCQty,DoubleType,true),StructField(ActualProductIncrementalPCLSV,DoubleType,true),StructField(ActualProductIncrementalLSV,DoubleType,true),StructField(PlanProductUpliftPercent,DoubleType,true),StructField(ActualProductLSV,DoubleType,true),StructField(PlanProductBaselineLSV,DoubleType,true),StructField(ActualProductPostPromoEffectQty,DoubleType,true),StructField(PlanProductPostPromoEffectQty,DoubleType,true),StructField(ProductEN,StringType,true),StructField(PlanProductCaseQty,DoubleType,true),StructField(PlanProductBaselineCaseQty,DoubleType,true),StructField(ActualProductCaseQty,DoubleType,true),StructField(PlanProductPostPromoEffectLSVW1,DoubleType,true),StructField(PlanProductPostPromoEffectLSVW2,DoubleType,true),StructField(PlanProductPostPromoEffectLSV,DoubleType,true),StructField(ActualProductPostPromoEffectLSV,DoubleType,true),StructField(PlanProductIncrementalCaseQty,DoubleType,true),StructField(ActualProductPostPromoEffectQtyW1,DoubleType,true),StructField(ActualProductPostPromoEffectQtyW2,DoubleType,true),StructField(PlanProductPostPromoEffectQtyW1,DoubleType,true),StructField(PlanProductPostPromoEffectQtyW2,DoubleType,true),StructField(PlanProductPCPrice,DoubleType,true),StructField(ActualProductBaselineLSV,DoubleType,true),StructField(EAN_PC,StringType,true),StructField(PlanProductCaseLSV,DoubleType,true),StructField(ActualProductLSVByCompensation,DoubleType,true),StructField(PlanProductLSV,DoubleType,true),StructField(PlanProductIncrementalLSV,DoubleType,true),StructField(AverageMarker,IntegerType,true),StructField(Price,DoubleType,true),StructField(SumInvoiceProduct,DoubleType,true),StructField(ActualProductBaselineCaseQty,DoubleType,true),StructField(CreateDate,TimestampType,true),StructField(PlanProductBaselineVolume,DoubleType,true),StructField(PlanProductPostPromoEffectVolumeW1,DoubleType,true),StructField(PlanProductPostPromoEffectVolumeW2,DoubleType,true),StructField(PlanProductPostPromoEffectVolume,DoubleType,true),StructField(ActualProductQtySO,DoubleType,true),StructField(TPMmode,IntegerType,true),StructField(ModifiedDate,TimestampType,true),StructField(PlanProductPostPromoEffectW1,DoubleType,true),StructField(PlanProductPostPromoEffectW2,DoubleType,true),StructField(ActualProductPostPromoEffectLSVW1,DoubleType,true),StructField(ActualProductPostPromoEffectLSVW2,DoubleType,true),StructField(#QCCount,IntegerType,true))), 'PromoProductPriceIncrease': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(CreateDate,TimestampType,true),StructField(ZREP,StringType,true),StructField(EAN_Case,StringType,true),StructField(EAN_PC,StringType,true),StructField(PlanProductCaseQty,DoubleType,true),StructField(PlanProductPCQty,IntegerType,true),StructField(PlanProductCaseLSV,DoubleType,true),StructField(PlanProductPCLSV,DoubleType,true),StructField(PlanProductBaselineLSV,DoubleType,true),StructField(ActualProductBaselineLSV,DoubleType,true),StructField(PlanProductIncrementalLSV,DoubleType,true),StructField(PlanProductLSV,DoubleType,true),StructField(PlanProductBaselineCaseQty,DoubleType,true),StructField(Price,DoubleType,true),StructField(PlanProductPCPrice,DoubleType,true),StructField(ActualProductPCQty,IntegerType,true),StructField(ActualProductCaseQty,DoubleType,true),StructField(ActualProductUOM,StringType,true),StructField(ActualProductSellInPrice,DoubleType,true),StructField(ActualProductShelfDiscount,DoubleType,true),StructField(ActualProductPCLSV,DoubleType,true),StructField(ActualProductUpliftPercent,DoubleType,true),StructField(ActualProductIncrementalPCQty,DoubleType,true),StructField(ActualProductIncrementalPCLSV,DoubleType,true),StructField(ActualProductIncrementalLSV,DoubleType,true),StructField(PlanProductPostPromoEffectLSVW1,DoubleType,true),StructField(PlanProductPostPromoEffectLSVW2,DoubleType,true),StructField(PlanProductPostPromoEffectLSV,DoubleType,true),StructField(ActualProductPostPromoEffectLSV,DoubleType,true),StructField(PlanProductIncrementalCaseQty,DoubleType,true),StructField(PlanProductUpliftPercent,DoubleType,true),StructField(AverageMarker,IntegerType,true),StructField(ActualProductLSV,DoubleType,true),StructField(ActualProductPostPromoEffectQtyW1,DoubleType,true),StructField(ActualProductPostPromoEffectQtyW2,DoubleType,true),StructField(ActualProductPostPromoEffectQty,DoubleType,true),StructField(PlanProductPostPromoEffectQtyW1,DoubleType,true),StructField(PlanProductPostPromoEffectQtyW2,DoubleType,true),StructField(PlanProductPostPromoEffectQty,DoubleType,true),StructField(ProductEN,StringType,true),StructField(ActualProductLSVByCompensation,DoubleType,true),StructField(ActualProductBaselineCaseQty,DoubleType,true),StructField(SumInvoiceProduct,DoubleType,true),StructField(PlanProductBaselineVolume,DoubleType,true),StructField(PlanProductPostPromoEffectVolumeW1,DoubleType,true),StructField(PlanProductPostPromoEffectVolumeW2,DoubleType,true),StructField(PlanProductPostPromoEffectVolume,DoubleType,true),StructField(ActualProductQtySO,DoubleType,true),StructField(PromoProductId,StringType,true),StructField(PromoPriceIncreaseId,StringType,true),StructField(#QCCount,IntegerType,true))), 'PromoProductTree': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(PromoId,StringType,true),StructField(ProductTreeObjectId,IntegerType,true),StructField(#QCCount,IntegerType,true))), 'PromoProductsCorrection': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(PromoProductId,StringType,true),StructField(PlanProductUpliftPercentCorrected,DoubleType,true),StructField(UserId,StringType,true),StructField(CreateDate,TimestampType,true),StructField(ChangeDate,TimestampType,true),StructField(UserName,StringType,true),StructField(TempId,StringType,true),StructField(TPMmode,IntegerType,true),StructField(#QCCount,IntegerType,true))), 'PromoProductCorrectionPriceIncrease': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(PlanProductUpliftPercentCorrected,DoubleType,true),StructField(TempId,StringType,true),StructField(UserId,StringType,true),StructField(UserName,StringType,true),StructField(CreateDate,TimestampType,true),StructField(ChangeDate,TimestampType,true),StructField(PromoProductPriceIncreaseId,StringType,true),StructField(#QCCount,IntegerType,true))), 'PromoStatus': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(Name,StringType,true),StructField(SystemName,StringType,true),StructField(Color,StringType,true),StructField(#QCCount,IntegerType,true))), 'PromoSupport': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(ClientTreeId,IntegerType,true),StructField(BudgetSubItemId,StringType,true),StructField(StartDate,TimestampType,true),StructField(EndDate,TimestampType,true),StructField(PlanQuantity,IntegerType,true),StructField(ActualQuantity,IntegerType,true),StructField(PlanCostTE,DoubleType,true),StructField(ActualCostTE,DoubleType,true),StructField(PlanProdCostPer1Item,DoubleType,true),StructField(ActualProdCostPer1Item,DoubleType,true),StructField(PlanProdCost,DoubleType,true),StructField(ActualProdCost,DoubleType,true),StructField(UserTimestamp,StringType,true),StructField(AttachFileName,StringType,true),StructField(BorderColor,StringType,true),StructField(Number,IntegerType,true),StructField(PONumber,StringType,true),StructField(InvoiceNumber,StringType,true),StructField(OffAllocation,BooleanType,true),StructField(#QCCount,IntegerType,true))), 'PromoSupportPromo': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(PromoId,StringType,true),StructField(PromoSupportId,StringType,true),StructField(PlanCalculation,DoubleType,true),StructField(FactCalculation,DoubleType,true),StructField(PlanCostProd,DoubleType,true),StructField(FactCostProd,DoubleType,true),StructField(TPMmode,IntegerType,true),StructField(#QCCount,IntegerType,true))), 'RATIShopper': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(Year,IntegerType,true),StructField(ClientTreeId,IntegerType,true),StructField(RATIShopperPercent,FloatType,true),StructField(#QCCount,IntegerType,true))), 'RollingVolume': StructType(List(StructField(Id,StringType,true),StructField(DemandGroup,StringType,true),StructField(Week,StringType,true),StructField(PlanProductIncrementalQTY,DoubleType,true),StructField(Actuals,DoubleType,true),StructField(OpenOrders,DoubleType,true),StructField(Baseline,DoubleType,true),StructField(ActualIncremental,DoubleType,true),StructField(PreviousRollingVolumes,DoubleType,true),StructField(Lock,BooleanType,true),StructField(ProductId,StringType,true),StructField(DMDGroup,StringType,true),StructField(PromoDifference,DoubleType,true),StructField(ActualOO,DoubleType,true),StructField(PreliminaryRollingVolumes,DoubleType,true),StructField(RollingVolumesTotal,DoubleType,true),StructField(ManualRollingTotalVolumes,DoubleType,true),StructField(RollingVolumesCorrection,DoubleType,true),StructField(FullWeekDiff,DoubleType,true),StructField(#QCCount,IntegerType,true))), 'ServiceInfo': StructType(List(StructField(Id,StringType,true),StructField(Name,StringType,true),StructField(Value,StringType,true),StructField(Description,StringType,true),StructField(#QCCount,IntegerType,true))), 'Setting': StructType(List(StructField(Id,StringType,true),StructField(Name,StringType,true),StructField(Type,StringType,true),StructField(Value,StringType,true),StructField(Description,StringType,true),StructField(#QCCount,IntegerType,true))), 'TradeInvestment': StructType(List(StructField(Id,StringType,true),StructField(Disabled,IntegerType,true),StructField(DeletedDate,TimestampType,true),StructField(StartDate,TimestampType,true),StructField(EndDate,TimestampType,true),StructField(ClientTreeId,IntegerType,true),StructField(BrandTechId,StringType,true),StructField(TIType,StringType,true),StructField(TISubType,StringType,true),StructField(SizePercent,FloatType,true),StructField(MarcCalcROI,BooleanType,true),StructField(MarcCalcBudgets,BooleanType,true),StructField(Year,IntegerType,true),StructField(#QCCount,IntegerType,true)))}\n"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_2101068611",
      "id": "paragraph_1660198152320_1236962199",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "FINISHED",
      "$$hashKey": "object:903",
      "dateFinished": "2023-07-13T13:39:14+0000",
      "dateStarted": "2023-07-13T13:39:13+0000"
    },
    {
      "text": "%pyspark\r\npromoDF = spark.read.csv(PROMO_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"Promo\"])\\\r\n.withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\\\r\n.withColumn(\"InOut\",col(\"InOut\").cast(BooleanType()))\r\npromoStatusDF = spark.read.csv(PROMOSTATUS_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"PromoStatus\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\nproductDF = spark.read.csv(PRODUCT_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"Product\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\nbrandTechDF = spark.read.csv(BRANDTECH_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"BrandTech\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\npromoProductDF = spark.read.csv(PROMOPRODUCT_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"PromoProduct\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\nclientHierarchyDF = spark.read.csv(CLIENTHIERARCHY_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"ClientTreeHierarchyView\"])\r\npromoProductTreeDF = spark.read.csv(PROMOPRODUCTTREE_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"PromoProductTree\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\nchangesIncidentsDF = spark.read.csv(CHANGESINCIDENTS_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"ChangesIncident\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\nproductChangeIncidentsDF = spark.read.csv(PRODUCTCHANGEINCIDENTS_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"ProductChangeIncident\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\nassortmentMatrixDF = spark.read.csv(ASSORTMENTMATRIX_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"AssortmentMatrix\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\npriceListDF = spark.read.csv(PRICELIST_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"PriceList\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType())).withColumn(\"FuturePriceMarker\",col(\"FuturePriceMarker\").cast(BooleanType()))\r\nbaselineDF = spark.read.csv(BASELINE_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"BaseLine\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\nincreaseBaselineDF = spark.read.csv(INCREASEBASELINE_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"BaseLine\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\nsharesDF = spark.read.csv(SHARES_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"ClientTreeBrandTech\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\nclientTreeDF = spark.read.csv(CLIENTTREE_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"ClientTree\"])\r\nproductTreeDF = spark.read.csv(PRODUCTTREE_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"ProductTree\"])\r\ncorrectionDF = spark.read.csv(CORRECTION_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"PromoProductsCorrection\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\nplanPostPromoEffectDF = spark.read.csv(PLANPOSTPROMOEFFECT_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"PlanPostPromoEffect\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\nincrementalDF = spark.read.csv(INCREMENTAL_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"IncrementalPromo\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\ncogsDF = spark.read.csv(COGS_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"COGS\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\ncogsTnDF = spark.read.csv(COGSTN_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"PlanCOGSTn\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\ntiDF = spark.read.csv(TI_PATH,sep=\"\\u0001\",header=True,schema=schemas_map[\"TradeInvestment\"]).withColumn(\"Disabled\",col(\"Disabled\").cast(BooleanType()))\r\ndatesDF = spark.read.format(\"csv\").option(\"delimiter\",\"|\").option(\"header\",\"true\").schema(datesDimSchema).load(DATESDIM_PATH)",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T13:11:54+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "ERROR",
        "msg": [
          {
            "type": "TEXT",
            "data": "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m\n\u001b[0;31mKeyError\u001b[0m                                  Traceback (most recent call last)\n\u001b[0;32m<ipython-input-40-05b325158648>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[1;32m     18\u001b[0m \u001b[0mproductTreeDF\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mspark\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mread\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcsv\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mPRODUCTTREE_PATH\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0msep\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m\"\\u0001\"\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mheader\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mTrue\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mschema\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mschemas_map\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"ProductTree\"\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     19\u001b[0m \u001b[0mcorrectionDF\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mspark\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mread\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcsv\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mCORRECTION_PATH\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0msep\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m\"\\u0001\"\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mheader\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mTrue\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mschema\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mschemas_map\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"PromoProductsCorrection\"\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mwithColumn\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"Disabled\"\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mcol\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"Disabled\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcast\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mBooleanType\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 20\u001b[0;31m \u001b[0mplanPostPromoEffectDF\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mspark\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mread\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcsv\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mPLANPOSTPROMOEFFECT_PATH\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0msep\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m\"\\u0001\"\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mheader\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mTrue\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mschema\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mschemas_map\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"PlanPostPromoEffect\"\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     21\u001b[0m \u001b[0mincrementalDF\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mspark\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mread\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcsv\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mINCREMENTAL_PATH\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0msep\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m\"\\u0001\"\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mheader\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mTrue\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mschema\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mschemas_map\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"IncrementalPromo\"\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mwithColumn\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"Disabled\"\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mcol\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"Disabled\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcast\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mBooleanType\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     22\u001b[0m \u001b[0mcogsDF\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mspark\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mread\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcsv\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mCOGS_PATH\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0msep\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m\"\\u0001\"\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mheader\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mTrue\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mschema\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mschemas_map\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"COGS\"\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mwithColumn\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"Disabled\"\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mcol\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"Disabled\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcast\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mBooleanType\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\n\u001b[0;31mKeyError\u001b[0m: 'PlanPostPromoEffect'"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1721105311",
      "id": "20220810-113330_453367110",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "ERROR",
      "$$hashKey": "object:904",
      "dateFinished": "2023-07-13T13:00:38+0000",
      "dateStarted": "2023-07-13T13:00:37+0000"
    },
    {
      "text": "%pyspark\n",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/scala",
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1931228803",
      "id": "paragraph_1681635299029_1224991750",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:905"
    },
    {
      "text": "%pyspark\ntry:\n#   dbutils.fs.ls(INPUT_FILE_LOG_PATH)\n inputLogMessageDF = spark.read.format(\"csv\").option(\"delimiter\",\"\\u0001\").option(\"header\",\"true\").load(INPUT_FILE_LOG_PATH)\n print('Log has been already made')\nexcept:\n inputLogMessageDF = spark.createDataFrame(sc.emptyRDD(), inputLogMessageSchema)\n print('Init log')\n  \n",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "Init log\n"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_716474035",
      "id": "20220810-113330_468171818",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:906"
    },
    {
      "text": "%pyspark\nnotCheckPromoStatusList = ['Draft', 'Cancelled', 'Deleted', 'Closed', 'Started', 'Finished']\nactualCogsTiRecalculationPromoStatusList = ['Finished', 'Closed']",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1201542300",
      "id": "20220810-113330_2102408644",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:907"
    },
    {
      "text": "%pyspark\npromoFilterDF = promoDF\\\n  .join(promoStatusDF, promoStatusDF.Id == promoDF.PromoStatusId, 'inner')\\\n  .select(\\\n           promoDF.Id\n          ,promoDF.Disabled\n          ,promoDF.Number\n          ,promoDF.BrandTechId\n          ,promoDF.ClientTreeKeyId\n          ,promoDF.ClientTreeId\n          ,promoDF.InOut\n          ,date_add(to_date(promoDF.DispatchesStart, 'yyyy-MM-dd'), 1).alias('DispatchesStart')\n          ,date_add(to_date(promoDF.StartDate, 'yyyy-MM-dd'), 1).alias('StartDate')\n          ,date_add(to_date(promoDF.EndDate, 'yyyy-MM-dd'), 1).alias('EndDate')\n          ,promoStatusDF.SystemName.alias('promoStatusName')\n         )\\\n  .where((~col('promoStatusName').isin(*notCheckPromoStatusList)) & (col('Disabled') == 'False'))\n\nactualCogsTiRecalculationPromoDF = promoDF\\\n  .join(promoStatusDF, promoStatusDF.Id == promoDF.PromoStatusId, 'inner')\\\n  .select(\\\n           promoDF.Id\n          ,promoDF.Disabled\n          ,promoDF.Number\n          ,promoStatusDF.SystemName.alias('promoStatusName')\n         )\\\n  .where((col('promoStatusName').isin(*actualCogsTiRecalculationPromoStatusList)) & (col('Disabled') == 'False'))\n\npromoFilterDF = promoFilterDF\\\n  .join(brandTechDF, brandTechDF.Id == promoFilterDF.BrandTechId, 'left')\\\n  .select(\\\n           promoFilterDF['*']\n          ,brandTechDF.BrandsegTechsub.alias('promoBrandTechName')\n         )\\\n\nactivePromoProductDF = promoProductDF.where(col('Disabled') == 'false')\nactiveClientTreeDF = clientTreeDF.where(col('EndDate').isNull())\n\nactiveClientTreeList = activeClientTreeDF.collect()",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_2146685467",
      "id": "20220810-113330_981221566",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:908"
    },
    {
      "text": "%pyspark\nactiveChangesIncidentsDF = changesIncidentsDF\\\n  .withColumn('ItemId', upper(col('ItemId')))\\\n  .where(col('ProcessDate').isNull())\n\nprocessChangesIncidentsDF = changesIncidentsDF\\\n  .where(~col('ProcessDate').isNull())\\\n  .drop('#QCCount')\n\nassortmentMatrixCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'AssortmentMatrix').select(activeChangesIncidentsDF.ItemId.alias('Id'))\npriceListCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'PriceList').select(activeChangesIncidentsDF.ItemId.alias('Id'))\nbaselineCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'BaseLine').select(activeChangesIncidentsDF.ItemId.alias('Id'))\nincreaseBaselineCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'IncreaseBaseLine').select(activeChangesIncidentsDF.ItemId.alias('Id'))\nsharesCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'ClientTreeBrandTech').select(activeChangesIncidentsDF.ItemId.alias('Id'))\nclientTreeCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'ClientTree').select(activeChangesIncidentsDF.ItemId.alias('Id'))\nproductTreeCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'ProductTree').select(activeChangesIncidentsDF.ItemId.alias('Id'))\ncorrectionCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'PromoProductsCorrection').select(activeChangesIncidentsDF.ItemId.alias('Id'))\nincrementalCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'IncrementalPromo').select(activeChangesIncidentsDF.ItemId.alias('Id'))\ncogsCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'COGS').select(activeChangesIncidentsDF.ItemId.alias('Id'))\ncogsTnCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'PlanCOGSTn').select(activeChangesIncidentsDF.ItemId.alias('Id'))\ntiCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'TradeInvestment').select(activeChangesIncidentsDF.ItemId.alias('Id'))\nactualCogsCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'PromoActualCOGS').select(activeChangesIncidentsDF.ItemId.alias('Id'))\nactualCogsTnCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'PromoActualCOGSTn').select(activeChangesIncidentsDF.ItemId.alias('Id'))\nactualTiCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'PromoActualTradeInvestment').select(activeChangesIncidentsDF.ItemId.alias('Id'))\npromoScenarioIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'PromoScenario').select(activeChangesIncidentsDF.ItemId.alias('Id'))\nppeCiIdsDF = activeChangesIncidentsDF.where(col('DirectoryName') == 'PlanPostPromoEffect').select(activeChangesIncidentsDF.ItemId.alias('Id'))\n\nprint('total incidents count:', activeChangesIncidentsDF.count())\nprint('assortmentMatrix incidents count:', assortmentMatrixCiIdsDF.count())\nprint('priceList incidents count:', priceListCiIdsDF.count())\nprint('baseline incidents count:', baselineCiIdsDF.count())\nprint('increase baseline incidents count:', increaseBaselineCiIdsDF.count())\nprint('shares incidents count:', sharesCiIdsDF.count())\nprint('clientTree incidents count:', clientTreeCiIdsDF.count())\nprint('productTree incidents count:', productTreeCiIdsDF.count())\nprint('correction incidents count:', correctionCiIdsDF.count())\nprint('incremental incidents count:', incrementalCiIdsDF.count())\nprint('cogs incidents count:', cogsCiIdsDF.count())\nprint('cogstn incidents count:', cogsTnCiIdsDF.count())\nprint('ti incidents count:', tiCiIdsDF.count())\nprint('actual cogs incidents count:', actualCogsCiIdsDF.count())\nprint('actual cogstn incidents count:', actualCogsTnCiIdsDF.count())\nprint('actual ti incidents count:', actualTiCiIdsDF.count())\nprint('promo scenario incidents count:', promoScenarioIdsDF.count())",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "total incidents count: 4327618\nassortmentMatrix incidents count: 0\npriceList incidents count: 7616\nbaseline incidents count: 4320001\nincrease baseline incidents count: 0\nshares incidents count: 0\nclientTree incidents count: 0\nproductTree incidents count: 0\ncorrection incidents count: 0\nincremental incidents count: 1\ncogs incidents count: 0\ncogstn incidents count: 0\nti incidents count: 0\nactual cogs incidents count: 0\nactual cogstn incidents count: 0\nactual ti incidents count: 0\npromo scenario incidents count: 0\n"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1732398370",
      "id": "20220810-113330_258350418",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:909"
    },
    {
      "text": "%pyspark\nactiveProductChangeIncidentsDF = productChangeIncidentsDF\\\n  .where(col('RecalculationProcessDate').isNull())\n\nprocessProductChangeIncidentsDF = productChangeIncidentsDF\\\n  .where(~col('RecalculationProcessDate').isNull())\\\n  .drop('#QCCount')\n\nprint('total product incidents count:', activeProductChangeIncidentsDF.count())",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "total product incidents count: 40\n"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_673899775",
      "id": "20220810-113330_700905080",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:910"
    },
    {
      "text": "%md\n#####*Get promo numbers filtered by assortment matrix  changes incidents*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorMode": "ace/mode/markdown",
        "colWidth": 12,
        "editorHide": true,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<p>#####<em>Get promo numbers filtered by assortment matrix  changes incidents</em></p>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_259681385",
      "id": "20220810-113330_1430522001",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:911"
    },
    {
      "text": "%pyspark\nassortmentMatrixCiDF = assortmentMatrixCiIdsDF\\\n  .join(assortmentMatrixDF, 'Id', 'inner')\\\n  .select(\\\n           assortmentMatrixDF.ClientTreeId\n          ,date_add(to_date(assortmentMatrixDF.StartDate, 'yyyy-MM-dd'), 1).alias('StartDate')\n          ,date_add(to_date(assortmentMatrixDF.EndDate, 'yyyy-MM-dd'), 1).alias('EndDate')\n         )\n\npromoByAssortmentMatrixCiDF = assortmentMatrixCiDF\\\n  .join(promoFilterDF,\n        [\\\n          assortmentMatrixCiDF.ClientTreeId == promoFilterDF.ClientTreeKeyId\n         ,assortmentMatrixCiDF.StartDate <= promoFilterDF.DispatchesStart\n         ,assortmentMatrixCiDF.EndDate >= promoFilterDF.DispatchesStart\n        ]\\\n        ,'inner')\\\n  .where(promoFilterDF.InOut == 'false')\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)\\\n  .dropDuplicates()",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1342570679",
      "id": "20220810-113330_224779063",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:912"
    },
    {
      "text": "%md\n#####*Get promo numbers filtered by pricelist changes incidents*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorMode": "ace/mode/markdown",
        "colWidth": 12,
        "editorHide": true,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<p>#####<em>Get promo numbers filtered by pricelist changes incidents</em></p>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1251567846",
      "id": "20220810-113330_852937540",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:913"
    },
    {
      "text": "%pyspark\npriceListCiDF = priceListCiIdsDF\\\n  .join(priceListDF, 'Id', 'inner')\\\n  .select(\\\n           priceListDF.ClientTreeId\n          ,priceListDF.FuturePriceMarker \n          ,date_add(to_date(priceListDF.StartDate, 'yyyy-MM-dd'), 1).alias('StartDate')\n          ,date_add(to_date(priceListDF.EndDate, 'yyyy-MM-dd'), 1).alias('EndDate')\n         )\n\npromoByPriceListCiDF = priceListCiDF\\\n  .where(priceListCiDF.FuturePriceMarker == 'false')\\\n  .join(promoFilterDF,\n        [\\\n          priceListCiDF.ClientTreeId == promoFilterDF.ClientTreeKeyId\n         ,priceListCiDF.StartDate <= promoFilterDF.DispatchesStart\n         ,priceListCiDF.EndDate >= promoFilterDF.DispatchesStart\n        ]\\\n        ,'inner')\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)\\\n  .dropDuplicates()\n\npromoByIncreasePriceListCiDF = priceListCiDF\\\n  .where(priceListCiDF.FuturePriceMarker == 'true')\\\n  .join(promoFilterDF,\n        [\\\n          priceListCiDF.ClientTreeId == promoFilterDF.ClientTreeKeyId\n         ,priceListCiDF.StartDate <= promoFilterDF.DispatchesStart\n         ,priceListCiDF.EndDate >= promoFilterDF.DispatchesStart\n        ]\\\n        ,'inner')\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)\\\n  .dropDuplicates()",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "ERROR",
        "msg": [
          {
            "type": "TEXT",
            "data": "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m\n\u001b[0;31mAttributeError\u001b[0m                            Traceback (most recent call last)\n\u001b[0;32m<ipython-input-211-e600366b129b>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[1;32m      3\u001b[0m   .select(\\\n\u001b[1;32m      4\u001b[0m            \u001b[0mpriceListDF\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mClientTreeId\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 5\u001b[0;31m           \u001b[0;34m,\u001b[0m\u001b[0mpriceListDF\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mFuturePriceMarker\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      6\u001b[0m           \u001b[0;34m,\u001b[0m\u001b[0mdate_add\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mto_date\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mpriceListDF\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mStartDate\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m'yyyy-MM-dd'\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;36m1\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0malias\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'StartDate'\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      7\u001b[0m           \u001b[0;34m,\u001b[0m\u001b[0mdate_add\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mto_date\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mpriceListDF\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mEndDate\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m'yyyy-MM-dd'\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;36m1\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0malias\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'EndDate'\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\n\u001b[0;32m/usr/lib/spark/python/pyspark/sql/dataframe.py\u001b[0m in \u001b[0;36m__getattr__\u001b[0;34m(self, name)\u001b[0m\n\u001b[1;32m   1398\u001b[0m         \"\"\"\n\u001b[1;32m   1399\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mname\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcolumns\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1400\u001b[0;31m             raise AttributeError(\n\u001b[0m\u001b[1;32m   1401\u001b[0m                 \"'%s' object has no attribute '%s'\" % (self.__class__.__name__, name))\n\u001b[1;32m   1402\u001b[0m         \u001b[0mjc\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_jdf\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mapply\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mname\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\n\u001b[0;31mAttributeError\u001b[0m: 'DataFrame' object has no attribute 'FuturePriceMarker'"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_123083949",
      "id": "20220810-113330_742235728",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:914"
    },
    {
      "text": "%md\n#####*Get promo numbers filtered by baseline changes incidents*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorMode": "ace/mode/markdown",
        "colWidth": 12,
        "editorHide": true,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<p>#####<em>Get promo numbers filtered by baseline changes incidents</em></p>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1028229775",
      "id": "20220810-113330_1506286534",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:915"
    },
    {
      "text": "%pyspark\n@udf\ndef getDemandCode(objectId):\n  c = [x for x in activeClientTreeList if x.ObjectId == objectId]\n  if len(c) == 0:\n    return ''\n  while (len(c) != 0) & (c[0].Type != 'root') & ((c[0].DemandCode == '') | (c[0].DemandCode is None)):\n    c = [x for x in activeClientTreeList if x.ObjectId == c[0].parentId]\n    if len(c) == 0: \n      break\n  if len(c) == 0:\n    return ''\n  else:\n    return c[0].DemandCode",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_635720468",
      "id": "20220810-113330_2060967851",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:916"
    },
    {
      "text": "%pyspark\nbaselineCiDF = baselineCiIdsDF\\\n  .join(baselineDF, 'Id', 'inner')\\\n  .select(\\\n           baselineDF.ProductId\n          ,baselineDF.DemandCode\n          ,date_add(to_date(baselineDF.StartDate, 'yyyy-MM-dd'), 1).alias('StartDate')\n         )\n\nincreaseBaselineCiDF = increaseBaselineCiIdsDF\\\n  .join(increaseBaselineDF, 'Id', 'inner')\\\n  .select(\\\n           increaseBaselineDF.ProductId\n          ,increaseBaselineDF.DemandCode\n          ,date_add(to_date(increaseBaselineDF.StartDate, 'yyyy-MM-dd'), 1).alias('StartDate')\n         )\n\n#baselineCiDF = baselineCiDF.union(increaseBaselineCiDF)\n\nbaselineCiDF = baselineCiDF\\\n  .join(datesDF, datesDF.OriginalDate == baselineCiDF.StartDate, 'inner')\\\n  .select(\\\n          baselineCiDF['*']\n         ,datesDF.MarsWeekFullName\n         )\n\nincreaseBaselineCiDF = increaseBaselineCiDF\\\n  .join(datesDF, datesDF.OriginalDate == increaseBaselineCiDF.StartDate, 'inner')\\\n  .select(\\\n          increaseBaselineCiDF['*']\n         ,datesDF.MarsWeekFullName\n         )\n\npromoDemandDF = promoFilterDF\\\n  .select(\\\n           col('Id').alias('promoId')\n          ,col('Number').alias('promoNumber')\n          ,col('BrandTechId').alias('promoBrandTechId')\n          ,promoFilterDF.StartDate.alias('promoStartDate')\n          ,promoFilterDF.EndDate.alias('promoEndDate')\n          ,promoFilterDF.DispatchesStart.alias('promoDispatchesStart')\n          ,col('ClientTreeKeyId').alias('promoClientTreeKeyId')\n          ,col('ClientTreeId').alias('promoClientTreeId')\n          ,col('InOut').alias('promoInOut')\n         )\n\npromoDemandDF = promoDemandDF\\\n  .withColumn('productDemandCode', lit(getDemandCode(col('promoClientTreeId'))))\n\ntempList = promoDemandDF.collect()\nnewPromoDemandDF = spark.createDataFrame(tempList, promoDemandDF.schema)\n\n# join with promoProduct to get ZREP\npromoProductDemandDF = newPromoDemandDF\\\n  .join(promoProductDF, promoProductDF.PromoId == newPromoDemandDF.promoId, 'inner')\\\n  .select(\\\n           newPromoDemandDF['*']\n          ,promoProductDF.ProductId\n         )\n\npromoSplittedByWeekDF = promoProductDemandDF\\\n  .join(datesDF, \n        [\\\n          datesDF.OriginalDate >= promoProductDemandDF.promoStartDate\n         ,datesDF.OriginalDate <= promoProductDemandDF.promoEndDate\n        ], \n        'inner')\\\n  .select(\\\n          promoProductDemandDF.promoId\n         ,promoProductDemandDF.promoNumber\n         ,promoProductDemandDF.promoStartDate\n         ,promoProductDemandDF.promoEndDate\n         ,promoProductDemandDF.productDemandCode\n         ,promoProductDemandDF.ProductId\n         ,promoProductDemandDF.promoInOut\n         ,datesDF.MarsWeekFullName\n         ,datesDF.MarsDay\n         )\n\ncols = promoSplittedByWeekDF.columns\ncols.remove('MarsDay')\n\npromoSplittedByWeekDF = promoSplittedByWeekDF\\\n  .groupBy(cols)\\\n  .agg(count('*').cast(DecimalType(30,6)).alias('promoDaysInWeek'))\n\npromoByBaselineCiDF = baselineCiDF\\\n  .join(promoSplittedByWeekDF,\n        [\\\n          promoSplittedByWeekDF.productDemandCode == baselineCiDF.DemandCode\n         ,promoSplittedByWeekDF.ProductId == baselineCiDF.ProductId\n         ,promoSplittedByWeekDF.MarsWeekFullName == baselineCiDF.MarsWeekFullName\n        ])\\\n  .where(promoSplittedByWeekDF.promoInOut == 'false')\\\n  .select(promoSplittedByWeekDF.promoId.alias('Id'), promoSplittedByWeekDF.promoNumber.alias('Number'))\\\n  .dropDuplicates()\n \npromoByIncreaseBaselineCiDF = increaseBaselineCiDF\\\n  .join(promoSplittedByWeekDF,\n        [\\\n          promoSplittedByWeekDF.productDemandCode == increaseBaselineCiDF.DemandCode\n         ,promoSplittedByWeekDF.ProductId == increaseBaselineCiDF.ProductId\n         ,promoSplittedByWeekDF.MarsWeekFullName == increaseBaselineCiDF.MarsWeekFullName\n        ])\\\n  .where(promoSplittedByWeekDF.promoInOut == 'false')\\\n  .select(promoSplittedByWeekDF.promoId.alias('Id'), promoSplittedByWeekDF.promoNumber.alias('Number'))\\\n  .dropDuplicates()",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_719794517",
      "id": "20220810-113330_2120202078",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:917"
    },
    {
      "text": "%md\n#####*Get promo numbers filtered by shares changes incidents*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorMode": "ace/mode/markdown",
        "colWidth": 12,
        "editorHide": true,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<p>#####<em>Get promo numbers filtered by shares changes incidents</em></p>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1109264108",
      "id": "20220810-113330_1045457371",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:918"
    },
    {
      "text": "%pyspark\nsharesCiDF = sharesCiIdsDF\\\n  .join(sharesDF, 'Id', 'inner')\\\n  .select(\\\n           sharesDF.ClientTreeId\n          ,sharesDF.BrandTechId\n         )\n\npromoBySharesCiDF = sharesCiDF\\\n  .join(promoFilterDF,\n        [\\\n          promoFilterDF.ClientTreeKeyId == sharesCiDF.ClientTreeId\n         ,promoFilterDF.BrandTechId == sharesCiDF.BrandTechId\n        ]\\\n        ,'inner')\\\n  .where(promoFilterDF.InOut == 'false')\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)\\\n  .dropDuplicates()",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_632301173",
      "id": "20220810-113330_668943356",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:919"
    },
    {
      "text": "%md\n#####*Get promo numbers filtered by clienttree changes incidents*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorMode": "ace/mode/markdown",
        "colWidth": 12,
        "editorHide": true,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<p>#####<em>Get promo numbers filtered by clienttree changes incidents</em></p>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_482321172",
      "id": "20220810-113330_1664215595",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:920"
    },
    {
      "text": "%pyspark\nclientTreeCiDF = clientTreeCiIdsDF\\\n  .join(clientTreeDF, 'Id', 'inner')\\\n  .select(\\\n           clientTreeDF.ObjectId\n         )\n\npromoByClientTreeCiDF = clientTreeCiDF\\\n  .join(promoFilterDF,\n        [\\\n          promoFilterDF.ClientTreeId == clientTreeDF.ObjectId\n        ]\\\n        ,'inner')\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)\\\n  .dropDuplicates()",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1339932439",
      "id": "20220810-113330_1616335956",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:921"
    },
    {
      "text": "%md\n#####*Get promo numbers filtered by producttree changes incidents*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorMode": "ace/mode/markdown",
        "colWidth": 12,
        "editorHide": true,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<p>#####<em>Get promo numbers filtered by producttree changes incidents</em></p>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1475276866",
      "id": "20220810-113330_1567946548",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:922"
    },
    {
      "text": "%pyspark\nproductTreeCiDF = productTreeCiIdsDF\\\n  .join(productTreeDF, 'Id', 'inner')\\\n  .select(\\\n           productTreeDF.ObjectId\n         )\n\npromoByProductTreeCiDF = productTreeCiDF\\\n  .join(promoProductTreeDF, promoProductTreeDF.ProductTreeObjectId == productTreeCiDF.ObjectId, 'inner')\\\n  .join(promoFilterDF, promoFilterDF.Id == promoProductTreeDF.PromoId, 'inner')\\\n  .where(promoFilterDF.InOut == 'false')\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)\\\n  .dropDuplicates()",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_672033007",
      "id": "20220810-113330_6922181",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:923"
    },
    {
      "text": "%md\n#####*Get promo numbers filtered by plan post promo effect incidents*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true,
          "completionKey": "TAB",
          "completionSupport": false
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "ERROR",
        "msg": [
          {
            "type": "TEXT",
            "data": "<console>:24: \u001b[31merror: \u001b[0mnot found: value #####*\n       #####*Get promo numbers filtered by plan post promo effect incidents*\n       ^\n<console>:24: \u001b[31merror: \u001b[0mnot found: value promo\n       #####*Get promo numbers filtered by plan post promo effect incidents*\n                 ^\n<console>:24: \u001b[31merror: \u001b[0mnot found: value filtered\n       #####*Get promo numbers filtered by plan post promo effect incidents*\n                               ^\n<console>:24: \u001b[31merror: \u001b[0mnot found: value plan\n       #####*Get promo numbers filtered by plan post promo effect incidents*\n                                           ^\n<console>:24: \u001b[31merror: \u001b[0mnot found: value promo\n       #####*Get promo numbers filtered by plan post promo effect incidents*\n                                                     ^\n<console>:24: \u001b[31merror: \u001b[0mnot found: value incidents\n       #####*Get promo numbers filtered by plan post promo effect incidents*\n                                                                  ^\n"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1300514755",
      "id": "paragraph_1688851788084_112909915",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:924"
    },
    {
      "text": "%pyspark\n\nppeCiDF = ppeCiIdsDF\\\n  .join(planPostPromoEffectDF, 'Id', 'inner')\\\n  .select(\\\n           planPostPromoEffectDF.BrandTechId\n         )\n\npromoByPPECiDF = ppeCiDF\\\n  .join(promoFilterDF, promoFilterDF.BrandTechId == promoProductDF.BrandTechId, 'inner')\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)\\\n  .dropDuplicates()\n",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/scala",
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1736142993",
      "id": "paragraph_1688851792270_468739231",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:925"
    },
    {
      "text": "%md\n#####*Get promo numbers filtered by correction changes incidents*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "tableHide": true,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorMode": "ace/mode/markdown",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<p>#####<em>Get promo numbers filtered by correction changes incidents</em></p>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_795150452",
      "id": "20220810-113330_1818582353",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:926"
    },
    {
      "text": "%pyspark\ncorrectionCiDF = correctionCiIdsDF\\\n  .join(correctionDF, 'Id', 'inner')\\\n  .select(\\\n           correctionDF.PromoProductId\n         )\n\npromoByCorrectionCiDF = correctionCiDF\\\n  .join(promoProductDF, promoProductDF.Id == correctionCiDF.PromoProductId, 'inner')\\\n  .join(promoFilterDF, promoFilterDF.Id == promoProductDF.PromoId, 'inner')\\\n  .where(promoFilterDF.InOut == 'false')\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)\\\n  .dropDuplicates()",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_448819274",
      "id": "20220810-113330_910836093",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:927"
    },
    {
      "text": "%md\n#####*Get promo numbers filtered by incremental changes incidents*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorMode": "ace/mode/markdown",
        "colWidth": 12,
        "editorHide": true,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<p>#####<em>Get promo numbers filtered by incremental changes incidents</em></p>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_945763359",
      "id": "20220810-113330_1283317207",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:928"
    },
    {
      "text": "%pyspark\nincrementalCiDF = incrementalCiIdsDF\\\n  .join(incrementalDF, 'Id', 'inner')\\\n  .select(\\\n           incrementalDF.PromoId\n         )\n\npromoByIncrementalCiDF = incrementalCiDF\\\n  .join(promoFilterDF, promoFilterDF.Id == incrementalCiDF.PromoId, 'inner')\\\n  .where(promoFilterDF.InOut == 'true')\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)\\\n  .dropDuplicates()",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_2119767389",
      "id": "20220810-113330_2548778",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:929"
    },
    {
      "text": "%md\n#####*Get promo numbers filtered by cogs changes incidents*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorMode": "ace/mode/markdown",
        "colWidth": 12,
        "editorHide": true,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<p>#####<em>Get promo numbers filtered by cogs changes incidents</em></p>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_582599958",
      "id": "20220810-113330_1181728426",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:930"
    },
    {
      "text": "%pyspark\ncogsDF = cogsDF\\\n  .withColumn('StartDate', date_add(to_date(cogsDF.StartDate, 'yyyy-MM-dd'), 1))\\\n  .withColumn('EndDate', date_add(to_date(cogsDF.EndDate, 'yyyy-MM-dd'), 1))\ncogsTnDF = cogsTnDF\\\n  .withColumn('StartDate', date_add(to_date(cogsTnDF.StartDate, 'yyyy-MM-dd'), 1))\\\n  .withColumn('EndDate', date_add(to_date(cogsTnDF.EndDate, 'yyyy-MM-dd'), 1))\n\ncogsClientDF = cogsDF\\\n  .join(clientTreeDF, clientTreeDF.Id == cogsDF.ClientTreeId, 'inner')\\\n  .join(brandTechDF, brandTechDF.Id == cogsDF.BrandTechId, 'inner')\\\n  .select(\\\n           cogsDF.Id\n          ,cogsDF.StartDate.alias('cogsStartDate')\n          ,cogsDF.EndDate.alias('cogsEndDate')\n          ,cogsDF.LSVpercent\n          ,clientTreeDF.ObjectId.alias('cogsClientTreeObjectId')\n          ,brandTechDF.BrandsegTechsub.alias('cbtName')\n         )\ncogsTnClientDF = cogsTnDF\\\n  .join(clientTreeDF, clientTreeDF.Id == cogsTnDF.ClientTreeId, 'inner')\\\n  .join(brandTechDF, brandTechDF.Id == cogsTnDF.BrandTechId, 'inner')\\\n  .select(\\\n           cogsTnDF.Id\n          ,cogsTnDF.StartDate.alias('cogsStartDate')\n          ,cogsTnDF.EndDate.alias('cogsEndDate')\n          ,cogsTnDF.TonCost\n          ,clientTreeDF.ObjectId.alias('cogsClientTreeObjectId')\n          ,brandTechDF.BrandsegTechsub.alias('cbtName')\n         )\n\ncogsClientList = cogsClientDF.collect()\ncogsCiIdsList = [row.Id for row in cogsCiIdsDF.collect()]\n\ncogsTnClientList = cogsTnClientDF.collect()\ncogsTnCiIdsList = [row.Id for row in cogsTnCiIdsDF.collect()]",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1976968594",
      "id": "20220810-113330_575295155",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:931"
    },
    {
      "text": "%pyspark\n@udf\ndef isPromoFilteredByGogs(objectId, brandTechName, dispatchesStart):\n  c = [x for x in activeClientTreeList if x.ObjectId == objectId]\n  cogs = []\n  while (len(cogs) == 0) & (len(c) != 0) & (c[0].Type != 'root'):\n    cogs = [x for x in cogsClientList if x.cogsClientTreeObjectId == c[0].ObjectId and x.cbtName == brandTechName\\\n                                         and x.cogsStartDate <= dispatchesStart and x.cogsEndDate >= dispatchesStart]\n    c = [x for x in activeClientTreeList if x.ObjectId == c[0].parentId]\n  \n  if len(cogs) == 0:\n    while (len(cogs) == 0) & (len(c) != 0) & (c[0].Type != 'root'):\n      cogs = [x for x in cogsClientList if x.cogsClientTreeObjectId == c[0].ObjectId and x.cbtName is None\\\n                                         and x.cogsStartDate <= dispatchesStart and x.cogsEndDate >= dispatchesStart]\n      c = [x for x in activeClientTreeList if x.ObjectId == c[0].parentId]\n      \n  isFiltered = False\n  \n  if len(cogs) == 0:\n    return False\n  else:\n    for item in cogs:\n      if item.Id in cogsCiIdsList:\n        isFiltered = True\n    return isFiltered",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_894725695",
      "id": "20220810-113330_16493640",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:932"
    },
    {
      "text": "%pyspark\n@udf\ndef isPromoFilteredByCogsTn(objectId, brandTechName, dispatchesStart):\n  c = [x for x in activeClientTreeList if x.ObjectId == int(objectId)]\n  cogs = []\n  while (len(cogs) == 0) & (len(c) != 0) & (c[0].Type != 'root'):\n    cogs = [x for x in cogsTnClientList if x.cogsClientTreeObjectId == c[0].ObjectId and x.cbtName == brandTechName\\\n                                         and x.cogsStartDate <= dispatchesStart and x.cogsEndDate >= dispatchesStart]\n    c = [x for x in activeClientTreeList if x.ObjectId == c[0].parentId]\n  \n  if len(cogs) == 0:\n    while (len(cogs) == 0) & (len(c) != 0) & (c[0].Type != 'root'):\n      cogs = [x for x in cogsTnClientList if x.cogsClientTreeObjectId == c[0].ObjectId and x.cbtName is None\\\n                                         and x.cogsStartDate <= dispatchesStart and x.cogsEndDate >= dispatchesStart]\n      c = [x for x in activeClientTreeList if x.ObjectId == c[0].parentId]\n      \n  isFiltered = False\n  \n  if len(cogs) == 0:\n    return False\n  else:\n    for item in cogs:\n      if item.Id in cogsTnCiIdsList:\n        isFiltered = True\n    return isFiltered",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1052038027",
      "id": "20220810-113330_936054729",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:933"
    },
    {
      "text": "%pyspark\npromoByCogsCiDF = promoFilterDF\\\n  .withColumn('isFilteredByGogs', lit(isPromoFilteredByGogs(col('ClientTreeId'), col('promoBrandTechName'), col('DispatchesStart'))))\\\n  .where(col('isFilteredByGogs') == True)\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)\\\n  .dropDuplicates()\n\npromoByCogsTnCiDF = promoFilterDF\\\n  .withColumn('isFilteredByGogs', lit(isPromoFilteredByCogsTn(col('ClientTreeId'), col('promoBrandTechName'), col('DispatchesStart'))))\\\n  .where(col('isFilteredByGogs') == True)\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)\\\n  .dropDuplicates()",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_142496029",
      "id": "20220810-113330_216690036",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:934"
    },
    {
      "text": "%md\n#####*Get promo numbers filtered by ti changes incidents*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorMode": "ace/mode/markdown",
        "colWidth": 12,
        "editorHide": true,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<p>#####<em>Get promo numbers filtered by ti changes incidents</em></p>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1087567424",
      "id": "20220810-113330_2082833804",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:935"
    },
    {
      "text": "%pyspark\ntiDF = tiDF\\\n  .withColumn('StartDate', date_add(to_date(tiDF.StartDate, 'yyyy-MM-dd'), 1))\\\n  .withColumn('EndDate', date_add(to_date(tiDF.EndDate, 'yyyy-MM-dd'), 1))\n\ntiClientNullBtDF = tiDF\\\n  .join(clientTreeDF, clientTreeDF.Id == tiDF.ClientTreeId, 'inner')\\\n  .select(\\\n           tiDF.Id\n          ,tiDF.StartDate.alias('tiStartDate')\n          ,tiDF.EndDate.alias('tiEndDate')\n          ,tiDF.SizePercent\n          ,clientTreeDF.ObjectId.alias('tiClientTreeObjectId')\n         )\\\n  .withColumn('tibtName', lit(None).cast(StringType()))\n\ntiClientNotNullBtDF = tiDF\\\n  .join(clientTreeDF, clientTreeDF.Id == tiDF.ClientTreeId, 'inner')\\\n  .join(brandTechDF, brandTechDF.Id == tiDF.BrandTechId, 'inner')\\\n  .select(\\\n           tiDF.Id\n          ,tiDF.StartDate.alias('tiStartDate')\n          ,tiDF.EndDate.alias('tiEndDate')\n          ,tiDF.SizePercent\n          ,clientTreeDF.ObjectId.alias('tiClientTreeObjectId')\n          ,brandTechDF.BrandsegTechsub.alias('tibtName')\n         )\n\ntiClientList = tiClientNullBtDF.union(tiClientNotNullBtDF).collect()\ntiCiIdsList = [row.Id for row in tiCiIdsDF.collect()]",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_1046862374",
      "id": "20220810-113330_568455084",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:936"
    },
    {
      "text": "%pyspark\n@udf\ndef isPromoFilteredByTi(objectId, brandTechName, startDate):\n  c = [x for x in activeClientTreeList if x.ObjectId == objectId]\n  ti = []\n  while (len(ti) == 0) & (len(c) != 0) & (c[0].Type != 'root'):\n    ti = [x for x in tiClientList if x.tiClientTreeObjectId == c[0].ObjectId and (x.tibtName == brandTechName or x.tibtName is None)\\\n                                     and x.tiStartDate <= startDate and x.tiEndDate >= startDate]\n    c = [x for x in activeClientTreeList if x.ObjectId == c[0].parentId]\n    \n  isFiltered = False  \n    \n  if len(ti) == 0:\n    return False\n  else:\n    for item in ti:\n      if item.Id in tiCiIdsList:\n        isFiltered = True\n    return isFiltered",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_922756957",
      "id": "20220810-113330_1320880414",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:937"
    },
    {
      "text": "%pyspark\npromoByTiCiDF = promoFilterDF\\\n  .withColumn('isFilteredByTi', lit(isPromoFilteredByTi(col('ClientTreeId'), col('promoBrandTechName'), col('DispatchesStart'))))\\\n  .where(col('isFilteredByTi') == True)\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_381349494",
      "id": "20220810-113330_291851376",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:938"
    },
    {
      "text": "%md\n#####*Get promo numbers filtered by actual cogs changes incidents*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorMode": "ace/mode/markdown",
        "colWidth": 12,
        "editorHide": true,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<p>#####<em>Get promo numbers filtered by actual cogs changes incidents</em></p>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_34662828",
      "id": "20220810-113330_1102881333",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:939"
    },
    {
      "text": "%pyspark\npromoByActualCogsCiDF = actualCogsTiRecalculationPromoDF\\\n  .join(actualCogsCiIdsDF, actualCogsCiIdsDF.Id == actualCogsTiRecalculationPromoDF.Id, 'inner')\\\n  .where(~actualCogsCiIdsDF.Id.isNull())\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)\\\n  .dropDuplicates()\n\npromoByActualCogsTnCiDF = actualCogsTiRecalculationPromoDF\\\n  .join(actualCogsTnCiIdsDF, actualCogsTnCiIdsDF.Id == actualCogsTiRecalculationPromoDF.Id, 'inner')\\\n  .where(~actualCogsTnCiIdsDF.Id.isNull())\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)\\\n  .dropDuplicates()\n\npromoByActualCogsCiDF.show()",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "+---+------+\n| Id|Number|\n+---+------+\n+---+------+\n\n"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_2103324352",
      "id": "20220810-113330_1871620385",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:940"
    },
    {
      "text": "%md\n#####*Get promo numbers filtered by actual ti changes incidents*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorMode": "ace/mode/markdown",
        "colWidth": 12,
        "editorHide": true,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<p>#####<em>Get promo numbers filtered by actual ti changes incidents</em></p>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_513440340",
      "id": "20220810-113330_2045488695",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:941"
    },
    {
      "text": "%pyspark\npromoByActualTiCiDF = actualCogsTiRecalculationPromoDF\\\n  .join(actualTiCiIdsDF, actualTiCiIdsDF.Id == actualCogsTiRecalculationPromoDF.Id, 'inner')\\\n  .where(~actualTiCiIdsDF.Id.isNull())\\\n  .select(promoFilterDF.Id, promoFilterDF.Number)\\\n  .dropDuplicates()\n\npromoByActualTiCiDF.show()",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "+---+------+\n| Id|Number|\n+---+------+\n+---+------+\n\n"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_3176973",
      "id": "20220810-113330_1121352630",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:942"
    },
    {
      "text": "%md\n#####*Get promo numbers filtered by product changes incidents*",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorMode": "ace/mode/markdown",
        "colWidth": 12,
        "editorHide": true,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<p>#####<em>Get promo numbers filtered by product changes incidents</em></p>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_848243221",
      "id": "20220810-113330_1717552339",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:943"
    },
    {
      "text": "%pyspark\npromoByProductCiDF = promoFilterDF\\\n  .join(promoProductTreeDF, promoProductTreeDF.PromoId == promoFilterDF.Id, 'inner')\\\n  .join(productTreeDF, productTreeDF.ObjectId == promoProductTreeDF.ProductTreeObjectId, 'inner')\\\n  .select(\\\n           promoFilterDF.Id.alias('promoId')\n          ,promoFilterDF.ClientTreeKeyId\n          ,promoFilterDF.DispatchesStart\n          ,promoFilterDF.Disabled.alias('pptDisabled')\n          ,promoFilterDF.Number.alias('pNumber')\n          ,productTreeDF.EndDate\n          ,promoFilterDF.InOut\n          ,lower(productTreeDF.FilterQuery).alias('FilterQuery')\n         )\\\n  .where((col('pptDisabled') == 'false') & (col('EndDate').isNull()))\n\ninoutPromoByProductCiDF = promoByProductCiDF.where(col('InOut') == 'true')\nnotInoutPromoByProductCiDF = promoByProductCiDF.where(col('InOut') == 'false')\n\nlowerCaseProductDF = productDF.select(*[lower(col(c)).name(c) for c in productDF.columns])\nlowerCaseProductDF = lowerCaseProductDF.toDF(*[c.lower() for c in lowerCaseProductDF.columns])",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526694_358908250",
      "id": "20220810-113330_2088943256",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:944"
    },
    {
      "text": "%pyspark\r\npromoByProductCiList = notInoutPromoByProductCiDF.collect()\r\n\r\nfilteredArray = []\r\nlowerCaseProductDF.registerTempTable(\"product\")\r\n\r\nfilteredProductSchema = StructType([\r\n  StructField(\"Id\", StringType(), False),\r\n  StructField(\"Number\", IntegerType(), False),\r\n  StructField(\"fPromoId\", StringType(), False),\r\n])\r\n\r\nfor i, item in enumerate(promoByProductCiList):\r\n#   print(i, item.pNumber, item.promoId)\r\n  productFilter = item.FilterQuery.replace('['+schema.lower()+'].[', '').replace('].[', '.').replace('[', '').replace(']', '').replace('*', 'id')\r\n  filteredIdsList = spark.sql(productFilter).collect()\r\n#   print(productFilter)\r\n#   print(filteredIdsList)\r\n  for productId in filteredIdsList:\r\n    filteredArray.append([productId[0], item.pNumber, item.promoId])\r\n    \r\nfilteredProductDF = spark.createDataFrame(filteredArray, filteredProductSchema)",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526695_1390127186",
      "id": "20220810-113330_1488727337",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:945"
    },
    {
      "text": "%pyspark\nprint(filteredProductDF.count())",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "102518\n"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526695_266171712",
      "id": "20220810-113330_700900931",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:946"
    },
    {
      "text": "%pyspark\nactiveAssortmentMatrixDF = assortmentMatrixDF.where(col('Disabled') == 'false')\n\nfilteredProductDF = filteredProductDF.withColumn('Id', upper(filteredProductDF.Id))\n\ncols = filteredProductDF.columns\n\nresultFilteredProductDF = filteredProductDF\\\n  .join(activeAssortmentMatrixDF, activeAssortmentMatrixDF.ProductId == filteredProductDF.Id, 'inner')\\\n  .select(filteredProductDF['*'])\\\n  .dropDuplicates()",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526695_723049593",
      "id": "20220810-113330_833079028",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:947"
    },
    {
      "text": "%pyspark\nprint(resultFilteredProductDF.count())",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "53398\n"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526695_592318435",
      "id": "20220810-113330_1480116262",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:948"
    },
    {
      "text": "%pyspark\nnotInoutPromoByProductCiDF = resultFilteredProductDF\\\n  .join(activeProductChangeIncidentsDF, activeProductChangeIncidentsDF.ProductId == resultFilteredProductDF.Id, 'inner')\\\n  .select(resultFilteredProductDF.fPromoId.alias('Id'), resultFilteredProductDF.Number)\\\n  .dropDuplicates()\n\ninoutPromoByProductCiDF = inoutPromoByProductCiDF\\\n  .join(activePromoProductDF, activePromoProductDF.PromoId == inoutPromoByProductCiDF.promoId, 'inner')\\\n  .join(activeProductChangeIncidentsDF, activeProductChangeIncidentsDF.ProductId == activePromoProductDF.ProductId, 'inner')\\\n  .select(inoutPromoByProductCiDF.promoId.alias('Id'), inoutPromoByProductCiDF.pNumber.alias('Number'))\\\n  .dropDuplicates()\n\npromoByProductCiDF = notInoutPromoByProductCiDF.union(inoutPromoByProductCiDF)",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526695_1057813181",
      "id": "20220810-113330_1632920429",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:949"
    },
    {
      "text": "%pyspark\ntitleMessage = '[INFO]: PROMO FILTERING'\ntitleLogMessageDF = spark.createDataFrame([(titleMessage,)], inputLogMessageSchema)\n\npromoNumbersByAssortmentMatrixCiDF = promoByAssortmentMatrixCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by Assortment matrix incidents: '))\npromoNumbersByAssortmentMatrixCiDF = promoNumbersByAssortmentMatrixCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersByPriceListCiDF = promoByPriceListCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by Pricelist incidents: '))\npromoNumbersByPriceListCiDF = promoNumbersByPriceListCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersByIncreasePriceListCiDF = promoByIncreasePriceListCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by Increase Pricelist incidents: '))\npromoNumbersByIncreasePriceListCiDF = promoNumbersByIncreasePriceListCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersByBaselineCiDF = promoByBaselineCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by Baseline incidents: '))\npromoNumbersByBaselineCiDF = promoNumbersByBaselineCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n  \npromoNumbersByIncreaseBaselineCiDF = promoByIncreaseBaselineCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by Increase Baseline incidents: '))\npromoNumbersByIncreaseBaselineCiDF = promoNumbersByIncreaseBaselineCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersBySharesCiDF = promoBySharesCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by Shares incidents: '))\npromoNumbersBySharesCiDF = promoNumbersBySharesCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersByClientTreeCiDF = promoByClientTreeCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by ClientTree incidents: '))\npromoNumbersByClientTreeCiDF = promoNumbersByClientTreeCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersByProductTreeCiDF = promoByProductTreeCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by ProductTree incidents: '))\npromoNumbersByProductTreeCiDF = promoNumbersByProductTreeCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n  \npromoNumbersByPpeCiDF = promoByPPECiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by Plan Post Promo Effect incidents: '))\npromoNumbersByPpeCiDF = promoNumbersByPpeCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersByCorrectionCiDF = promoByCorrectionCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by Correction incidents: '))\npromoNumbersByCorrectionCiDF = promoNumbersByCorrectionCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersByIncrementalCiDF = promoByIncrementalCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by Incremental incidents: '))\npromoNumbersByIncrementalCiDF = promoNumbersByIncrementalCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersByCogsCiDF = promoByCogsCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by COGS incidents: '))\npromoNumbersByCogsCiDF = promoNumbersByCogsCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersByCogsTnCiDF = promoByCogsTnCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by COGSTn incidents: '))\npromoNumbersByCogsTnCiDF = promoNumbersByCogsTnCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersByTiCiDF = promoByTiCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by TI incidents: '))\npromoNumbersByTiCiDF = promoNumbersByTiCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersByActualCogsCiDF = promoByActualCogsCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by Actual COGS incidents: '))\npromoNumbersByActualCogsCiDF = promoNumbersByActualCogsCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersByActualCogsTnCiDF = promoByActualCogsTnCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by Actual COGSTn incidents: '))\npromoNumbersByActualCogsTnCiDF = promoNumbersByActualCogsTnCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersByActualTiCiDF = promoByActualTiCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by Actual TI incidents: '))\npromoNumbersByActualTiCiDF = promoNumbersByActualTiCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersByProductCiDF = promoByProductCiDF.select(col('Number')).withColumn('Title', lit('[INFO]: Promo filtered by Product incidents: '))\npromoNumbersByProductCiDF = promoNumbersByProductCiDF\\\n  .groupBy('Title')\\\n  .agg(concat_ws(';', collect_list(col('Number'))).alias('Number'))\n\npromoNumbersFilteredByCiDF = promoNumbersByAssortmentMatrixCiDF\\\n  .union(promoNumbersByIncreasePriceListCiDF)\\\n  .union(promoNumbersByPriceListCiDF)\\\n  .union(promoNumbersByIncreaseBaselineCiDF)\\\n  .union(promoNumbersByBaselineCiDF)\\\n  .union(promoNumbersBySharesCiDF)\\\n  .union(promoNumbersByClientTreeCiDF)\\\n  .union(promoNumbersByProductTreeCiDF)\\\n  .union(promoNumbersByPpeCiDF)\\\n  .union(promoNumbersByCorrectionCiDF)\\\n  .union(promoNumbersByIncrementalCiDF)\\\n  .union(promoNumbersByCogsCiDF)\\\n  .union(promoNumbersByCogsTnCiDF)\\\n  .union(promoNumbersByTiCiDF)\\\n  .union(promoNumbersByActualCogsCiDF)\\\n  .union(promoNumbersByActualCogsTnCiDF)\\\n  .union(promoNumbersByActualTiCiDF)\\\n  .union(promoNumbersByProductCiDF)\n\nlogMessageDF = promoNumbersFilteredByCiDF\\\n  .withColumn('logMessage', concat(col('Title'), col('Number')))\\\n  .drop('Title', 'Number')\n\noutputLogMessageDF = inputLogMessageDF\\\n  .union(titleLogMessageDF)\\\n  .union(logMessageDF)\n\npromoByCiDF = promoByAssortmentMatrixCiDF\\\n  .union(promoByPriceListCiDF)\\\n  .union(promoByBaselineCiDF)\\\n  .union(promoBySharesCiDF)\\\n  .union(promoByClientTreeCiDF)\\\n  .union(promoByProductTreeCiDF)\\\n  .union(promoByPPECiDF)\\\n  .union(promoByCorrectionCiDF)\\\n  .union(promoByIncrementalCiDF)\\\n  .union(promoByCogsCiDF)\\\n  .union(promoByCogsTnCiDF)\\\n  .union(promoByTiCiDF)\\\n  .union(promoByActualCogsCiDF)\\\n  .union(promoByActualCogsTnCiDF)\\\n  .union(promoByActualTiCiDF)\\\n  .union(promoByProductCiDF)\n\nincreasePromoByCiDF = promoByIncreaseBaselineCiDF\\\n  .union(promoByIncreasePriceListCiDF)\n\nblockedPromoDF = promoByCiDF\\\n  .select(col('Id').alias('PromoId'))\\\n  .withColumn('HandlerId', lit(handlerId))\n\nblockedPromoDF = blockedPromoDF.dropDuplicates()\n\nblockedIncreasePromoDF = increasePromoByCiDF\\\n  .select(col('Id').alias('PromoId'))\\\n  .withColumn('HandlerId', lit(handlerId))\n\nblockedIncreasePromoDF = blockedIncreasePromoDF.dropDuplicates()\n\nactiveChangesIncidentsDF = activeChangesIncidentsDF\\\n  .withColumn('Disabled', lit(True))\\\n  .drop('#QCCount')\n\nactiveProductChangeIncidentsDF = activeProductChangeIncidentsDF\\\n  .withColumn('Disabled', lit(True))\\\n  .drop('#QCCount')\n\nresultChangesIncidentsDF = activeChangesIncidentsDF.union(processChangesIncidentsDF)\nresultProductChangeIncidentsDF = activeProductChangeIncidentsDF.union(processProductChangeIncidentsDF)\n\n\n",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionSupport": true,
          "completionKey": "TAB"
        },
        "editorMode": "ace/mode/python",
        "colWidth": 12,
        "editorHide": false,
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526695_1725209798",
      "id": "20220810-113330_1881250975",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:950"
    },
    {
      "title": "Save results",
      "text": "%pyspark\nblockedPromoDF.write.mode(\"overwrite\").parquet(BLOCKEDPROMO_OUTPUT_PATH)\nblockedPromoDF\\\n.repartition(1)\\\n.write.csv(BLOCKEDPROMO_OUTPUT_PATH_CSV,\nsep=\"\\u0001\",\nheader=True,\nmode=\"overwrite\",\nemptyValue=\"\"\n)\n\nblockedIncreasePromoDF.write.mode(\"overwrite\").parquet(BLOCKEDINCREASEPROMO_OUTPUT_PATH)\nblockedIncreasePromoDF\\\n.repartition(1)\\\n.write.csv(BLOCKEDINCREASEPROMO_OUTPUT_PATH_CSV,\nsep=\"\\u0001\",\nheader=True,\nmode=\"overwrite\",\nemptyValue=\"\"\n)\n\n\n#resultChangesIncidentsDF.write.mode(\"overwrite\").parquet(CHANGESINCIDENTS_OUTPUT_PATH)\n#resultProductChangeIncidentsDF.write.mode(\"overwrite\").parquet(PRODUCTCHANGEINCIDENTS_OUTPUT_PATH)\n\nresultChangesIncidentsDF=resultChangesIncidentsDF\\\n.na.fill({\"Disabled\":False})\\\n.withColumn(\"Disabled\",col(\"Disabled\").cast(IntegerType()))\n\nresultChangesIncidentsDF\\\n.repartition(1)\\\n.write.csv(CHANGESINCIDENTS_OUTPUT_PATH,\nsep=\"\\u0001\",\nheader=True,\nmode=\"overwrite\",\nemptyValue=\"\",\ntimestampFormat=\"yyyy-MM-dd HH:mm:ss\"\n)\n\nresultProductChangeIncidentsDF\\\n.repartition(1)\\\n.write.csv(PRODUCTCHANGEINCIDENTS_OUTPUT_PATH,\nsep=\"\\u0001\",\nheader=True,\nmode=\"overwrite\",\nemptyValue=\"\",\ntimestampFormat=\"yyyy-MM-dd HH:mm:ss\"\n)\n\n",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/python",
        "fontSize": 9,
        "title": true,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "ERROR",
        "msg": [
          {
            "type": "TEXT",
            "data": "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m\n\u001b[0;31mPy4JJavaError\u001b[0m                             Traceback (most recent call last)\n\u001b[0;32m<ipython-input-164-9ee21e94242f>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0mblockedPromoDF\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mwrite\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mmode\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"overwrite\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mparquet\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mBLOCKEDPROMO_OUTPUT_PATH\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      2\u001b[0m \u001b[0mblockedPromoDF\u001b[0m\u001b[0;31m\\\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      3\u001b[0m \u001b[0;34m.\u001b[0m\u001b[0mrepartition\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;36m1\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;31m\\\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      4\u001b[0m .write.csv(BLOCKEDPROMO_OUTPUT_PATH_CSV,\n\u001b[1;32m      5\u001b[0m \u001b[0msep\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m\"\\u0001\"\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\n\u001b[0;32m/usr/lib/spark/python/pyspark/sql/readwriter.py\u001b[0m in \u001b[0;36mparquet\u001b[0;34m(self, path, mode, partitionBy, compression)\u001b[0m\n\u001b[1;32m    937\u001b[0m             \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mpartitionBy\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mpartitionBy\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    938\u001b[0m         \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_set_opts\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mcompression\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mcompression\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 939\u001b[0;31m         \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_jwrite\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mparquet\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mpath\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    940\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    941\u001b[0m     \u001b[0;34m@\u001b[0m\u001b[0msince\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;36m1.6\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\n\u001b[0;32m/usr/lib/spark/python/lib/py4j-0.10.9-src.zip/py4j/java_gateway.py\u001b[0m in \u001b[0;36m__call__\u001b[0;34m(self, *args)\u001b[0m\n\u001b[1;32m   1302\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   1303\u001b[0m         \u001b[0manswer\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mgateway_client\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msend_command\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mcommand\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1304\u001b[0;31m         return_value = get_return_value(\n\u001b[0m\u001b[1;32m   1305\u001b[0m             answer, self.gateway_client, self.target_id, self.name)\n\u001b[1;32m   1306\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\n\u001b[0;32m/usr/lib/spark/python/pyspark/sql/utils.py\u001b[0m in \u001b[0;36mdeco\u001b[0;34m(*a, **kw)\u001b[0m\n\u001b[1;32m    126\u001b[0m     \u001b[0;32mdef\u001b[0m \u001b[0mdeco\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m*\u001b[0m\u001b[0ma\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m**\u001b[0m\u001b[0mkw\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    127\u001b[0m         \u001b[0;32mtry\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 128\u001b[0;31m             \u001b[0;32mreturn\u001b[0m \u001b[0mf\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m*\u001b[0m\u001b[0ma\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m**\u001b[0m\u001b[0mkw\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    129\u001b[0m         \u001b[0;32mexcept\u001b[0m \u001b[0mpy4j\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mprotocol\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mPy4JJavaError\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0me\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    130\u001b[0m             \u001b[0mconverted\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mconvert_exception\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0me\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mjava_exception\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\n\u001b[0;32m/usr/lib/spark/python/lib/py4j-0.10.9-src.zip/py4j/protocol.py\u001b[0m in \u001b[0;36mget_return_value\u001b[0;34m(answer, gateway_client, target_id, name)\u001b[0m\n\u001b[1;32m    324\u001b[0m             \u001b[0mvalue\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mOUTPUT_CONVERTER\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0mtype\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0manswer\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;36m2\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mgateway_client\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    325\u001b[0m             \u001b[0;32mif\u001b[0m \u001b[0manswer\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;36m1\u001b[0m\u001b[0;34m]\u001b[0m \u001b[0;34m==\u001b[0m \u001b[0mREFERENCE_TYPE\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 326\u001b[0;31m                 raise Py4JJavaError(\n\u001b[0m\u001b[1;32m    327\u001b[0m                     \u001b[0;34m\"An error occurred while calling {0}{1}{2}.\\n\"\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    328\u001b[0m                     format(target_id, \".\", name), value)\n\n\u001b[0;31mPy4JJavaError\u001b[0m: An error occurred while calling o7768.parquet.\n: org.apache.hadoop.security.AccessControlException: Permission denied: user=zeppelin, access=WRITE, inode=\"/JUPITER/PROCESS/BlockedPromo\":dataproc-agent:hadoop:drwxr-xr-x\n\tat org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.check(FSPermissionChecker.java:399)\n\tat org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:258)\n\tat org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:193)\n\tat org.apache.hadoop.hdfs.server.namenode.FSDirectory.checkPermission(FSDirectory.java:1896)\n\tat org.apache.hadoop.hdfs.server.namenode.FSDirDeleteOp.delete(FSDirDeleteOp.java:110)\n\tat org.apache.hadoop.hdfs.server.namenode.FSNamesystem.delete(FSNamesystem.java:3104)\n\tat org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.delete(NameNodeRpcServer.java:1127)\n\tat org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.delete(ClientNamenodeProtocolServerSideTranslatorPB.java:708)\n\tat org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java)\n\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:528)\n\tat org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1086)\n\tat org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1029)\n\tat org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:957)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:422)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1762)\n\tat org.apache.hadoop.ipc.Server$Handler.run(Server.java:2957)\n\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:423)\n\tat org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:121)\n\tat org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:88)\n\tat org.apache.hadoop.hdfs.DFSClient.delete(DFSClient.java:1614)\n\tat org.apache.hadoop.hdfs.DistributedFileSystem$19.doCall(DistributedFileSystem.java:949)\n\tat org.apache.hadoop.hdfs.DistributedFileSystem$19.doCall(DistributedFileSystem.java:946)\n\tat org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)\n\tat org.apache.hadoop.hdfs.DistributedFileSystem.delete(DistributedFileSystem.java:956)\n\tat org.apache.spark.internal.io.FileCommitProtocol.deleteWithJob(FileCommitProtocol.scala:124)\n\tat org.apache.spark.sql.execution.datasources.InsertIntoHadoopFsRelationCommand.deleteMatchingPartitions(InsertIntoHadoopFsRelationCommand.scala:226)\n\tat org.apache.spark.sql.execution.datasources.InsertIntoHadoopFsRelationCommand.run(InsertIntoHadoopFsRelationCommand.scala:129)\n\tat org.apache.spark.sql.execution.command.DataWritingCommandExec.sideEffectResult$lzycompute(commands.scala:108)\n\tat org.apache.spark.sql.execution.command.DataWritingCommandExec.sideEffectResult(commands.scala:106)\n\tat org.apache.spark.sql.execution.command.DataWritingCommandExec.doExecute(commands.scala:131)\n\tat org.apache.spark.sql.execution.SparkPlan.$anonfun$execute$1(SparkPlan.scala:180)\n\tat org.apache.spark.sql.execution.SparkPlan.$anonfun$executeQuery$1(SparkPlan.scala:218)\n\tat org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)\n\tat org.apache.spark.sql.execution.SparkPlan.executeQuery(SparkPlan.scala:215)\n\tat org.apache.spark.sql.execution.SparkPlan.execute(SparkPlan.scala:176)\n\tat org.apache.spark.sql.execution.QueryExecution.toRdd$lzycompute(QueryExecution.scala:127)\n\tat org.apache.spark.sql.execution.QueryExecution.toRdd(QueryExecution.scala:126)\n\tat org.apache.spark.sql.DataFrameWriter.$anonfun$runCommand$1(DataFrameWriter.scala:962)\n\tat org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$5(SQLExecution.scala:100)\n\tat org.apache.spark.sql.execution.SQLExecution$.withSQLConfPropagated(SQLExecution.scala:160)\n\tat org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$1(SQLExecution.scala:87)\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:767)\n\tat org.apache.spark.sql.execution.SQLExecution$.withNewExecutionId(SQLExecution.scala:64)\n\tat org.apache.spark.sql.DataFrameWriter.runCommand(DataFrameWriter.scala:962)\n\tat org.apache.spark.sql.DataFrameWriter.saveToV1Source(DataFrameWriter.scala:414)\n\tat org.apache.spark.sql.DataFrameWriter.save(DataFrameWriter.scala:398)\n\tat org.apache.spark.sql.DataFrameWriter.save(DataFrameWriter.scala:287)\n\tat org.apache.spark.sql.DataFrameWriter.parquet(DataFrameWriter.scala:847)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)\n\tat py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)\n\tat py4j.Gateway.invoke(Gateway.java:282)\n\tat py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)\n\tat py4j.commands.CallCommand.execute(CallCommand.java:79)\n\tat py4j.GatewayConnection.run(GatewayConnection.java:238)\n\tat java.lang.Thread.run(Thread.java:750)\nCaused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.AccessControlException): Permission denied: user=zeppelin, access=WRITE, inode=\"/JUPITER/PROCESS/BlockedPromo\":dataproc-agent:hadoop:drwxr-xr-x\n\tat org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.check(FSPermissionChecker.java:399)\n\tat org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:258)\n\tat org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:193)\n\tat org.apache.hadoop.hdfs.server.namenode.FSDirectory.checkPermission(FSDirectory.java:1896)\n\tat org.apache.hadoop.hdfs.server.namenode.FSDirDeleteOp.delete(FSDirDeleteOp.java:110)\n\tat org.apache.hadoop.hdfs.server.namenode.FSNamesystem.delete(FSNamesystem.java:3104)\n\tat org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.delete(NameNodeRpcServer.java:1127)\n\tat org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.delete(ClientNamenodeProtocolServerSideTranslatorPB.java:708)\n\tat org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java)\n\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:528)\n\tat org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1086)\n\tat org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1029)\n\tat org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:957)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:422)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1762)\n\tat org.apache.hadoop.ipc.Server$Handler.run(Server.java:2957)\n\n\tat org.apache.hadoop.ipc.Client.getRpcResponse(Client.java:1562)\n\tat org.apache.hadoop.ipc.Client.call(Client.java:1508)\n\tat org.apache.hadoop.ipc.Client.call(Client.java:1405)\n\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:233)\n\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:118)\n\tat com.sun.proxy.$Proxy17.delete(Unknown Source)\n\tat org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolTranslatorPB.delete(ClientNamenodeProtocolTranslatorPB.java:644)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:422)\n\tat org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeMethod(RetryInvocationHandler.java:165)\n\tat org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invoke(RetryInvocationHandler.java:157)\n\tat org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeOnce(RetryInvocationHandler.java:95)\n\tat org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:359)\n\tat com.sun.proxy.$Proxy18.delete(Unknown Source)\n\tat org.apache.hadoop.hdfs.DFSClient.delete(DFSClient.java:1612)\n\t... 39 more\n"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526695_1586196431",
      "id": "paragraph_1660216357449_1381238890",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:951"
    },
    {
      "text": "%pyspark\nsc.setCheckpointDir(\"tmp\")\n\noutputLogMessageDF\\\n.checkpoint(eager=True)\\\n.repartition(1)\\\n.write.csv(INPUT_FILE_LOG_PATH,\nsep=\"\\u0001\",\nheader=True,\nmode=\"overwrite\",\nemptyValue=\"\",\n)\n\n#subprocess.call([\"hadoop\", \"fs\", \"-mv\", OUTPUT_TEMP_FILE_LOG_PATH, OUTPUT_LOG_PATH])\n#subprocess.call([\"hadoop\", \"fs\", \"-rm\", \"-r\", OUTPUT_TEMP_FILE_LOG_PATH])",
      "user": "anonymous",
      "dateUpdated": "2023-07-13T05:18:46+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/scala",
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1689225526695_1510141556",
      "id": "paragraph_1661163051034_1265806109",
      "dateCreated": "2023-07-13T05:18:46+0000",
      "status": "READY",
      "$$hashKey": "object:952"
    }
  ],
  "name": "JUPITER/PROMO_PARAMETERS_CALCULATION/PROMO_FILTERING_FOR_RECALCULATION",
  "id": "2J699PV9G",
  "defaultInterpreterGroup": "spark",
  "version": "0.9.0",
  "noteParams": {},
  "noteForms": {},
  "angularObjects": {},
  "config": {
    "isZeppelinNotebookCronEnable": false,
    "looknfeel": "default",
    "personalizedMode": "false"
  },
  "info": {},
  "path": "/JUPITER/PROMO_PARAMETERS_CALCULATION/PROMO_FILTERING_FOR_RECALCULATION"
}